"use strict";(self.webpackChunkfireERP=self.webpackChunkfireERP||[]).push([[982],{9179:(iv,Za,C)=>{C.r(Za),C.d(Za,{EmployeesModule:()=>sv});var _d=C(4977),Bt=C(1402),Ka=C(6087),Ga=C(4847),Ne=C(4999),Td=C(8746),l=C(5e3),Ed=C(4986),Id=C(8306),Ir=C(8996),$a=C(9646),ke=C(5813),qs=C(8675),xd=C(4482),Sd=C(5403);function Us(){return(0,xd.e)((n,e)=>{let t,r=!1;n.subscribe(new Sd.Q(e,s=>{const i=t;t=s,r&&e.next([i,s]),r=!0}))})}var E,Pe=C(4004),Vs=C(5026),bd=C(1884),za=C(9300),xr=C(2011),Qa=C(9808),Ad=(C(1119),C(3942)),p=C(5861),Sr=C(9681),Ha=C(4859),yt=C(1877),F=C(2090),Cd="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ge={},Bs=Bs||{},A=Cd||self;function br(){}function js(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function An(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Zs="closure_uid_"+(1e9*Math.random()>>>0),Nd=0;function kd(n,e,t){return n.call.apply(n.bind,arguments)}function Rd(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function se(n,e,t){return(se=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?kd:Rd).apply(null,arguments)}function Ar(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ie(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function tt(){this.s=this.s,this.o=this.o}var Fd={};tt.prototype.s=!1,tt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function Dd(n){return Object.prototype.hasOwnProperty.call(n,Zs)&&n[Zs]||(n[Zs]=++Nd)}(this);delete Fd[n]}},tt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Wa=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},Ya=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const r=n.length,s="string"==typeof n?n.split(""):n;for(let i=0;i<r;i++)i in s&&e.call(t,s[i],i,n)};function Ja(n){return Array.prototype.concat.apply([],arguments)}function Ks(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Cr(n){return/^[\s\xa0]*$/.test(n)}var ye,Xa=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function ge(n,e){return-1!=n.indexOf(e)}function Gs(n,e){return n<e?-1:n>e?1:0}e:{var eu=A.navigator;if(eu){var tu=eu.userAgent;if(tu){ye=tu;break e}}ye=""}function $s(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function nu(n){const e={};for(const t in n)e[t]=n[t];return e}var ru="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function su(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<ru.length;i++)t=ru[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function zs(n){return zs[" "](n),n}zs[" "]=br;var Dr,n,Pd=ge(ye,"Opera"),jt=ge(ye,"Trident")||ge(ye,"MSIE"),iu=ge(ye,"Edge"),Qs=iu||jt,ou=ge(ye,"Gecko")&&!(ge(ye.toLowerCase(),"webkit")&&!ge(ye,"Edge"))&&!(ge(ye,"Trident")||ge(ye,"MSIE"))&&!ge(ye,"Edge"),qd=ge(ye.toLowerCase(),"webkit")&&!ge(ye,"Edge");function au(){var n=A.document;return n?n.documentMode:void 0}e:{var Hs="",Ws=(n=ye,ou?/rv:([^\);]+)(\)|;)/.exec(n):iu?/Edge\/([\d\.]+)/.exec(n):jt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):qd?/WebKit\/(\S+)/.exec(n):Pd?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Ws&&(Hs=Ws?Ws[1]:""),jt){var Ys=au();if(null!=Ys&&Ys>parseFloat(Hs)){Dr=String(Ys);break e}}Dr=Hs}var Ud={};var Bd=A.document&&jt&&(au()||parseInt(Dr,10))||void 0,jd=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{A.addEventListener("test",br,e),A.removeEventListener("test",br,e)}catch(t){}return n}();function he(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}function Cn(n,e){if(he.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(ou){e:{try{zs(e.nodeName);var s=!0;break e}catch(i){}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Zd[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Cn.Z.h.call(this)}}he.prototype.h=function(){this.defaultPrevented=!0},ie(Cn,he);var Zd={2:"touch",3:"pen",4:"mouse"};Cn.prototype.h=function(){Cn.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Dn="closure_listenable_"+(1e6*Math.random()|0),Kd=0;function Gd(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ia=s,this.key=++Kd,this.ca=this.fa=!1}function Nr(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function kr(n){this.src=n,this.g={},this.h=0}function Xs(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=Wa(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Nr(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function ei(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ca&&i.listener==e&&i.capture==!!t&&i.ia==r)return s}return-1}kr.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=ei(n,e,r,s);return-1<o?(e=n[o],t||(e.fa=!1)):((e=new Gd(e,this.src,i,!!r,s)).fa=t,n.push(e)),e};var ti="closure_lm_"+(1e6*Math.random()|0),ni={};function cu(n,e,t,r,s){if(r&&r.once)return hu(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)cu(n,e[i],t,r,s);return null}return t=oi(t),n&&n[Dn]?n.N(e,t,An(r)?!!r.capture:!!r,s):lu(n,e,t,!1,r,s)}function lu(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=An(s)?!!s.capture:!!s,a=si(n);if(a||(n[ti]=a=new kr(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function $d(){var e=zd;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)jd||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(fu(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function hu(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)hu(n,e[i],t,r,s);return null}return t=oi(t),n&&n[Dn]?n.O(e,t,An(r)?!!r.capture:!!r,s):lu(n,e,t,!0,r,s)}function du(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)du(n,e[i],t,r,s);else r=An(r)?!!r.capture:!!r,t=oi(t),n&&n[Dn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=ei(i=n.g[e],t,r,s))&&(Nr(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=si(n))&&(e=n.g[e.toString()],n=-1,e&&(n=ei(e,t,r,s)),(t=-1<n?e[n]:null)&&ri(t))}function ri(n){if("number"!=typeof n&&n&&!n.ca){var e=n.src;if(e&&e[Dn])Xs(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(fu(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=si(e))?(Xs(t,n),0==t.h&&(t.src=null,e[ti]=null)):Nr(n)}}}function fu(n){return n in ni?ni[n]:ni[n]="on"+n}function zd(n,e){if(n.ca)n=!0;else{e=new Cn(e,this);var t=n.listener,r=n.ia||n.src;n.fa&&ri(n),n=t.call(r,e)}return n}function si(n){return(n=n[ti])instanceof kr?n:null}var ii="__closure_events_fn_"+(1e9*Math.random()>>>0);function oi(n){return"function"==typeof n?n:(n[ii]||(n[ii]=function(e){return n.handleEvent(e)}),n[ii])}function X(){tt.call(this),this.i=new kr(this),this.P=this,this.I=null}function oe(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new he(e,n);else if(e instanceof he)e.target=e.target||n;else{var s=e;su(e=new he(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=Rr(o,r,!0,e)&&s}if(s=Rr(o=e.g=n,r,!0,e)&&s,s=Rr(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=Rr(o=e.g=t[i],r,!1,e)&&s}function Rr(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==t){var a=o.listener,u=o.ia||o.src;o.fa&&Xs(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}ie(X,tt),X.prototype[Dn]=!0,X.prototype.removeEventListener=function(n,e,t,r){du(this,n,e,t,r)},X.prototype.M=function(){if(X.Z.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Nr(t[r]);delete n.g[e],n.h--}}this.I=null},X.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},X.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var ai=A.JSON.stringify;function Qd(){var n=pu;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var ci,mu=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new Wd,n=>n.reset());class Wd{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Yd(n){A.setTimeout(()=>{throw n},0)}function ui(n,e){ci||function Jd(){var n=A.Promise.resolve(void 0);ci=function(){n.then(Xd)}}(),li||(ci(),li=!0),pu.add(n,e)}var li=!1,pu=new class Hd{constructor(){this.h=this.g=null}add(e,t){const r=mu.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function Xd(){for(var n;n=Qd();){try{n.h.call(n.g)}catch(t){Yd(t)}var e=mu;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}li=!1}function Lr(n,e){X.call(this),this.h=n||1,this.g=e||A,this.j=se(this.kb,this),this.l=Date.now()}function hi(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function di(n,e,t){if("function"==typeof n)t&&(n=se(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=se(n.handleEvent,n)}return 2147483647<Number(e)?-1:A.setTimeout(n,e||0)}function gu(n){n.g=di(()=>{n.g=null,n.i&&(n.i=!1,gu(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ie(Lr,X),(E=Lr.prototype).da=!1,E.S=null,E.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),oe(this,"tick"),this.da&&(hi(this),this.start()))}},E.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},E.M=function(){Lr.Z.M.call(this),hi(this),delete this.g};class ef extends tt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:gu(this)}M(){super.M(),this.g&&(A.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Nn(n){tt.call(this),this.h=n,this.g={}}ie(Nn,tt);var yu=[];function vu(n,e,t,r){Array.isArray(t)||(t&&(yu[0]=t.toString()),t=yu);for(var s=0;s<t.length;s++){var i=cu(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function wu(n){$s(n.g,function(e,t){this.g.hasOwnProperty(t)&&ri(e)},n),n.g={}}function Fr(){this.g=!0}function Zt(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function sf(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return ai(t)}catch(a){return e}}(n,t)+(r?" "+r:"")})}Nn.prototype.M=function(){Nn.Z.M.call(this),wu(this)},Nn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Fr.prototype.Aa=function(){this.g=!1},Fr.prototype.info=function(){};var vt={},_u=null;function Mr(){return _u=_u||new X}function Tu(n){he.call(this,vt.Ma,n)}function kn(n){const e=Mr();oe(e,new Tu(e,n))}function Eu(n,e){he.call(this,vt.STAT_EVENT,n),this.stat=e}function ve(n){const e=Mr();oe(e,new Eu(e,n))}function Iu(n,e){he.call(this,vt.Na,n),this.size=e}function Rn(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){n()},e)}vt.Ma="serverreachability",ie(Tu,he),vt.STAT_EVENT="statevent",ie(Eu,he),vt.Na="timingevent",ie(Iu,he);var Or={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},xu={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function fi(){}function bu(){}fi.prototype.h=null;var gi,Ln={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function mi(){he.call(this,"d")}function pi(){he.call(this,"c")}function Pr(){}function Fn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.X=r||1,this.V=new Nn(this),this.P=of,this.W=new Lr(n=Qs?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Au}function Au(){this.i=null,this.g="",this.h=!1}ie(mi,he),ie(pi,he),ie(Pr,fi),Pr.prototype.g=function(){return new XMLHttpRequest},Pr.prototype.i=function(){return{}},gi=new Pr;var of=45e3,yi={},qr={};function vi(n,e,t){n.K=1,n.v=Zr($e(e)),n.s=t,n.U=!0,Cu(n,null)}function Cu(n,e){n.F=Date.now(),Mn(n),n.A=$e(n.v);var t=n.A,r=n.X;Array.isArray(r)||(r=[String(r)]),Pu(t.h,"t",r),n.C=0,t=n.l.H,n.h=new Au,n.g=oc(n.l,t?e:null,!n.s),0<n.O&&(n.L=new ef(se(n.Ia,n,n.g),n.O)),vu(n.V,n.g,"readystatechange",n.gb),e=n.H?nu(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),kn(1),function tf(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var d=h.split("_");o=2<=d.length&&"type"==d[1]?o+(h+"=")+c+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.X,n.s)}function Du(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function Nu(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=af(n,t),s==qr){4==e&&(n.o=4,ve(14),r=!1),Zt(n.j,n.m,null,"[Incomplete Response]");break}if(s==yi){n.o=4,ve(15),Zt(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Zt(n.j,n.m,s,null),wi(n,s)}Du(n)&&s!=qr&&s!=yi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,ve(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.aa&&(n.aa=!0,(e=n.l).g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ni(e),e.L=!0,ve(11))):(Zt(n.j,n.m,t,"[Invalid Chunked Response]"),wt(n),On(n))}function af(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?qr:(t=Number(e.substring(t,r)),isNaN(t)?yi:(r+=1)+t>e.length?qr:(e=e.substr(r,t),n.C=r+t,e))}function Mn(n){n.Y=Date.now()+n.P,ku(n,n.P)}function ku(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Rn(se(n.eb,n),e)}function Ur(n){n.B&&(A.clearTimeout(n.B),n.B=null)}function On(n){0==n.l.G||n.I||nc(n.l,n)}function wt(n){Ur(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,hi(n.W),wu(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function wi(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Ei(t.i,n)))if(t.I=n.N,!n.J&&Ei(t.i,n)&&3==t.G){try{var r=t.Ca.g.parse(e)}catch(c){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0])e:if(t.u)t.ta=s[1],0<t.ta-t.U&&37500>s[2]&&t.N&&0==t.A&&!t.v&&(t.v=Rn(se(t.ab,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Hr(t),zr(t)}Di(t),ve(18)}if(1>=Vu(t.i)&&t.ka){try{t.ka()}catch(c){}t.ka=void 0}}else Et(t,11)}else if((n.J||t.g==n)&&Hr(t),!Cr(e))for(s=t.Ca.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(t.U=c[0],c=c[1],2==t.G)if("c"==c[0]){t.J=c[1],t.la=c[2];const h=c[3];null!=h&&(t.ma=h,t.h.info("VER="+t.ma));const d=c[4];null!=d&&(t.za=d,t.h.info("SVER="+t.za));const f=c[5];null!=f&&"number"==typeof f&&0<f&&(t.K=r=1.5*f,t.h.info("backChannelRequestTimeoutMs_="+r)),r=t;const g=n.g;if(g){const w=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(w){var i=r.i;!i.g&&(ge(w,"spdy")||ge(w,"quic")||ge(w,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(Ii(i,i.h),i.h=null))}if(r.D){const S=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.sa=S,U(r.F,r.D,S))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=n;if((r=t).oa=ic(r,r.H?r.la:null,r.W),o.J){Bu(r.i,o);var a=o,u=r.K;u&&a.setTimeout(u),a.B&&(Ur(a),Mn(a)),r.g=o}else ec(r);0<t.l.length&&Qr(t)}else"stop"!=c[0]&&"close"!=c[0]||Et(t,7);else 3==t.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Et(t,7):Ai(t):"noop"!=c[0]&&t.j&&t.j.wa(c),t.A=0)}kn(4)}catch(c){}}function _i(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(js(n)||"string"==typeof n)Ya(n,e,void 0);else{if(n.T&&"function"==typeof n.T)var t=n.T();else if(n.R&&"function"==typeof n.R)t=void 0;else if(js(n)||"string"==typeof n){t=[];for(var r=n.length,s=0;s<r;s++)t.push(s)}else for(s in t=[],r=0,n)t[r++]=s;r=function uf(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(js(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),s=r.length;for(var i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}}function Kt(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var r=0;r<t;r+=2)this.set(arguments[r],arguments[r+1])}else if(n)if(n instanceof Kt)for(t=n.T(),r=0;r<t.length;r++)this.set(t[r],n.get(t[r]));else for(r in n)this.set(r,n[r])}function Ti(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var r=n.g[e];_t(n.h,r)&&(n.g[t++]=r),e++}n.g.length=t}if(n.i!=n.g.length){var s={};for(t=e=0;e<n.g.length;)_t(s,r=n.g[e])||(n.g[t++]=r,s[r]=1),e++;n.g.length=t}}function _t(n,e){return Object.prototype.hasOwnProperty.call(n,e)}(E=Fn.prototype).setTimeout=function(n){this.P=n},E.gb=function(n){n=n.target;const e=this.L;e&&3==ze(n)?e.l():this.Ia(n)},E.Ia=function(n){try{if(n==this.g)e:{const h=ze(this.g);var e=this.g.Da();const d=this.g.ba();if(!(3>h)&&(3!=h||Qs||this.g&&(this.h.h||this.g.ga()||Hu(this.g)))){this.I||4!=h||7==e||kn(8==e||0>=d?3:2),Ur(this);var t=this.g.ba();this.N=t;t:if(Du(this)){var r=Hu(this.g);n="";var s=r.length,i=4==ze(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){wt(this),On(this);var o="";break t}this.h.i=new A.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function nf(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.X,h,t),this.i){if(this.$&&!this.J){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Cr(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,ve(12),wt(this),On(this);break e}Zt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,wi(this,t)}this.U?(Nu(this,h,o),Qs&&this.i&&3==h&&(vu(this.V,this.W,"tick",this.fb),this.W.start())):(Zt(this.j,this.m,o,null),wi(this,o)),4==h&&wt(this),this.i&&!this.I&&(4==h?nc(this.l,this):(this.i=!1,Mn(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ve(12)):(this.o=0,ve(13)),wt(this),On(this)}}}catch(h){}},E.fb=function(){if(this.g){var n=ze(this.g),e=this.g.ga();this.C<e.length&&(Ur(this),Nu(this,n,e),this.i&&4!=n&&Mn(this))}},E.cancel=function(){this.I=!0,wt(this)},E.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function rf(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(kn(3),ve(17)),wt(this),this.o=2,On(this)):ku(this,this.Y-n)},(E=Kt.prototype).R=function(){Ti(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n},E.T=function(){return Ti(this),this.g.concat()},E.get=function(n,e){return _t(this.h,n)?this.h[n]:e},E.set=function(n,e){_t(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e},E.forEach=function(n,e){for(var t=this.T(),r=0;r<t.length;r++){var s=t[r],i=this.get(s);n.call(e,i,s,this)}};var Ru=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Tt(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof Tt){this.g=void 0!==e?e:n.g,Vr(this,n.j),this.s=n.s,Br(this,n.i),jr(this,n.m),this.l=n.l,e=n.h;var t=new Un;t.i=e.i,e.g&&(t.g=new Kt(e.g),t.h=e.h),Lu(this,t),this.o=n.o}else n&&(t=String(n).match(Ru))?(this.g=!!e,Vr(this,t[1]||"",!0),this.s=Pn(t[2]||""),Br(this,t[3]||"",!0),jr(this,t[4]),this.l=Pn(t[5]||"",!0),Lu(this,t[6]||"",!0),this.o=Pn(t[7]||"")):(this.g=!!e,this.h=new Un(null,this.g))}function $e(n){return new Tt(n)}function Vr(n,e,t){n.j=t?Pn(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Br(n,e,t){n.i=t?Pn(e,!0):e}function jr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Lu(n,e,t){e instanceof Un?(n.h=e,function yf(n,e){e&&!n.j&&(nt(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(Mu(this,r),Pu(this,s,t))},n)),n.j=e}(n.h,n.g)):(t||(e=qn(e,pf)),n.h=new Un(e,n.g))}function U(n,e,t){n.h.set(e,t)}function Zr(n){return U(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Pn(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function qn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,df),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function df(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Tt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(qn(e,Fu,!0),":");var t=this.i;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(qn(e,Fu,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&n.push("/"),n.push(qn(t,"/"==t.charAt(0)?mf:ff,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",qn(t,gf)),n.join("")};var Fu=/[#\/\?@]/g,ff=/[#\?:]/g,mf=/[#\?]/g,pf=/[#\?@]/g,gf=/#/g;function Un(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function nt(n){n.g||(n.g=new Kt,n.h=0,n.i&&function cf(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Mu(n,e){nt(n),e=Gt(n,e),_t(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,_t((n=n.g).h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&Ti(n)))}function Ou(n,e){return nt(n),e=Gt(n,e),_t(n.g.h,e)}function Pu(n,e,t){Mu(n,e),0<t.length&&(n.i=null,n.g.set(Gt(n,e),Ks(t)),n.h+=t.length)}function Gt(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function qu(n){this.l=n||wf,n=A.PerformanceNavigationTiming?0<(n=A.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(A.g&&A.g.Ea&&A.g.Ea()&&A.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(E=Un.prototype).add=function(n,e){nt(this),this.i=null,n=Gt(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},E.forEach=function(n,e){nt(this),this.g.forEach(function(t,r){Ya(t,function(s){n.call(e,s,r,this)},this)},this)},E.T=function(){nt(this);for(var n=this.g.R(),e=this.g.T(),t=[],r=0;r<e.length;r++)for(var s=n[r],i=0;i<s.length;i++)t.push(e[r]);return t},E.R=function(n){nt(this);var e=[];if("string"==typeof n)Ou(this,n)&&(e=Ja(e,this.g.get(Gt(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=Ja(e,n[t])}return e},E.set=function(n,e){return nt(this),this.i=null,Ou(this,n=Gt(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},E.get=function(n,e){return n&&0<(n=this.R(n)).length?String(n[0]):e},E.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var r=e[t],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),n.push(o)}}return this.i=n.join("&")};var wf=10;function Uu(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Vu(n){return n.h?1:n.g?n.g.size:0}function Ei(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Ii(n,e){n.g?n.g.add(e):n.h=e}function Bu(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function ju(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return Ks(n.i)}function xi(){}function _f(){this.g=new xi}function Tf(n,e,t){const r=t||"";try{_i(n,function(s,i){let o=s;An(s)&&(o=ai(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Kr(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function Vn(n){this.l=n.$b||null,this.j=n.ib||!1}function Gr(n,e){X.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Si,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}qu.prototype.cancel=function(){if(this.i=ju(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},xi.prototype.stringify=function(n){return A.JSON.stringify(n,void 0)},xi.prototype.parse=function(n){return A.JSON.parse(n,void 0)},ie(Vn,fi),Vn.prototype.g=function(){return new Gr(this.l,this.j)},Vn.prototype.i=function(n){return function(){return n}}({}),ie(Gr,X);var Si=0;function Zu(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function Bn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,jn(n)}function jn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(E=Gr.prototype).open=function(n,e){if(this.readyState!=Si)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,jn(this)},E.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||A).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},E.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Bn(this)),this.readyState=Si},E.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,jn(this)),this.g&&(this.readyState=3,jn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==A.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Zu(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},E.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Bn(this):jn(this),3==this.readyState&&Zu(this)}},E.Ua=function(n){this.g&&(this.response=this.responseText=n,Bn(this))},E.Ta=function(n){this.g&&(this.response=n,Bn(this))},E.ha=function(){this.g&&Bn(this)},E.setRequestHeader=function(n,e){this.v.append(n,e)},E.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},E.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Gr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var If=A.JSON.parse;function K(n){X.call(this),this.headers=new Kt,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ku,this.K=this.L=!1}ie(K,X);var Ku="",xf=/^https?$/i,Sf=["POST","PUT"];function Af(n){return"content-type"==n.toLowerCase()}function Gu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,$u(n),$r(n)}function $u(n){n.D||(n.D=!0,oe(n,"complete"),oe(n,"error"))}function zu(n){if(n.h&&void 0!==Bs&&(!n.C[1]||4!=ze(n)||2!=n.ba()))if(n.v&&4==ze(n))di(n.Fa,0,n);else if(oe(n,"readystatechange"),4==ze(n)){n.h=!1;try{const a=n.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(Ru)[1]||null;if(!s&&A.self&&A.self.location){var i=A.self.location.protocol;s=i.substr(0,i.length-1)}r=!xf.test(s?s.toLowerCase():"")}t=r}if(t)oe(n,"complete"),oe(n,"success");else{n.m=6;try{var o=2<ze(n)?n.g.statusText:""}catch(u){o=""}n.j=o+" ["+n.ba()+"]",$u(n)}}finally{$r(n)}}}function $r(n,e){if(n.g){Qu(n);const t=n.g,r=n.C[0]?br:null;n.g=null,n.C=null,e||oe(n,"ready");try{t.onreadystatechange=r}catch(s){}}}function Qu(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(A.clearTimeout(n.A),n.A=null)}function ze(n){return n.g?n.g.readyState:0}function Hu(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Ku:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function bi(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=function Cf(n){let e="";return $s(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):U(n,e,t))}function Zn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Wu(n){this.za=0,this.l=[],this.h=new Fr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Zn("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Zn("baseRetryDelayMs",5e3,n),this.$a=Zn("retryDelaySeedMs",1e4,n),this.Ya=Zn("forwardChannelMaxRetries",2,n),this.ra=Zn("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new qu(n&&n.concurrentRequestLimit),this.Ca=new _f,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function Ai(n){if(Yu(n),3==n.G){var e=n.V++,t=$e(n.F);U(t,"SID",n.J),U(t,"RID",e),U(t,"TYPE","terminate"),Kn(n,t),(e=new Fn(n,n.h,e,void 0)).K=2,e.v=Zr($e(t)),t=!1,A.navigator&&A.navigator.sendBeacon&&(t=A.navigator.sendBeacon(e.v.toString(),"")),!t&&A.Image&&((new Image).src=e.v,t=!0),t||(e.g=oc(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Mn(e)}sc(n)}function zr(n){n.g&&(Ni(n),n.g.cancel(),n.g=null)}function Yu(n){zr(n),n.u&&(A.clearTimeout(n.u),n.u=null),Hr(n),n.i.cancel(),n.m&&("number"==typeof n.m&&A.clearTimeout(n.m),n.m=null)}function Ci(n,e){n.l.push(new class{constructor(n,e){this.h=n,this.g=e}}(n.Za++,e)),3==n.G&&Qr(n)}function Qr(n){Uu(n.i)||n.m||(n.m=!0,ui(n.Ha,n),n.C=0)}function Ju(n,e){var t;t=e?e.m:n.V++;const r=$e(n.F);U(r,"SID",n.J),U(r,"RID",t),U(r,"AID",n.U),Kn(n,r),n.o&&n.s&&bi(r,n.o,n.s),t=new Fn(n,n.h,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=Xu(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),Ii(n.i,t),vi(t,r,e)}function Kn(n,e){n.j&&_i({},function(t,r){U(e,r,t)})}function Xu(n,e,t){t=Math.min(n.l.length,t);var r=n.j?se(n.j.Oa,n.j,n):null;e:{var s=n.l;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let c=s[u].h;const h=s[u].g;if(c-=i,0>c)i=Math.max(0,s[u].h-100),a=!1;else try{Tf(h,o,"req"+c+"_")}catch(d){r&&r(h)}}if(a){r=o.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,r}function ec(n){n.g||n.u||(n.Y=1,ui(n.Ga,n),n.A=0)}function Di(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=Rn(se(n.Ga,n),rc(n,n.A)),n.A++,0))}function Ni(n){null!=n.B&&(A.clearTimeout(n.B),n.B=null)}function tc(n){n.g=new Fn(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var e=$e(n.oa);U(e,"RID","rpc"),U(e,"SID",n.J),U(e,"CI",n.N?"0":"1"),U(e,"AID",n.U),Kn(n,e),U(e,"TYPE","xmlhttp"),n.o&&n.s&&bi(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=Zr($e(e)),t.s=null,t.U=!0,Cu(t,n)}function Hr(n){null!=n.v&&(A.clearTimeout(n.v),n.v=null)}function nc(n,e){var t=null;if(n.g==e){Hr(n),Ni(n),n.g=null;var r=2}else{if(!Ei(n.i,e))return;t=e.D,Bu(n.i,e),r=1}if(n.I=e.N,0!=n.G)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;oe(r=Mr(),new Iu(r,t,e,s)),Qr(n)}else ec(n);else if(3==(s=e.o)||0==s&&0<n.I||!(1==r&&function Df(n,e){return!(Vu(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=e.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=Rn(se(n.Ha,n,e),rc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Di(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:Et(n,5);break;case 4:Et(n,10);break;case 3:Et(n,6);break;default:Et(n,2)}}function rc(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function Et(n,e){if(n.h.info("Error code "+e),2==e){var t=null;n.j&&(t=null);var r=se(n.jb,n);t||(t=new Tt("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||Vr(t,"https"),Zr(t)),function Ef(n,e){const t=new Fr;if(A.Image){const r=new Image;r.onload=Ar(Kr,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ar(Kr,t,r,"TestLoadImage: error",!1,e),r.onabort=Ar(Kr,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ar(Kr,t,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else ve(2);n.G=0,n.j&&n.j.va(e),sc(n),Yu(n)}function sc(n){n.G=0,n.I=-1,n.j&&((0!=ju(n.i).length||0!=n.l.length)&&(n.i.i.length=0,Ks(n.l),n.l.length=0),n.j.ua())}function ic(n,e,t){let r=function lf(n){return n instanceof Tt?$e(n):new Tt(n,void 0)}(t);if(""!=r.i)e&&Br(r,e+"."+r.i),jr(r,r.m);else{const s=A.location;r=function hf(n,e,t,r){var s=new Tt(null,void 0);return n&&Vr(s,n),e&&Br(s,e),t&&jr(s,t),r&&(s.l=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,t)}return n.aa&&$s(n.aa,function(s,i){U(r,i,s)}),t=n.sa,(e=n.D)&&t&&U(r,e,t),U(r,"VER",n.ma),Kn(n,r),r}function oc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new K(t&&n.Ba&&!n.qa?new Vn({ib:!0}):n.qa)).L=n.H,e}function ac(){}function Wr(){if(jt&&!(10<=Number(Bd)))throw Error("Environmental error: no available transport.")}function be(n,e){X.call(this),this.g=new Wu(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!Cr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Cr(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new $t(this)}function uc(n){mi.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function cc(){pi.call(this),this.status=1}function $t(n){this.g=n}(E=K.prototype).ea=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():gi.g(),this.C=function Su(n){return n.h||(n.h=n.i())}(this.u?this.u:gi),this.g.onreadystatechange=se(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void Gu(this,i)}n=t||"";const s=new Kt(this.headers);r&&_i(r,function(i,o){s.set(o,i)}),r=function Md(n){e:{var e=Af;const t=n.length,r="string"==typeof n?n.split(""):n;for(let s=0;s<t;s++)if(s in r&&e.call(void 0,r[s],s,n)){e=s;break e}e=-1}return 0>e?null:"string"==typeof n?n.charAt(e):n[e]}(s.T()),t=A.FormData&&n instanceof A.FormData,!(0<=Wa(Sf,e))||r||t||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(i,o){this.g.setRequestHeader(o,i)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Qu(this),0<this.B&&((this.K=function bf(n){return jt&&function Vd(){return function Od(n){var e=Ud;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=Xa(String(Dr)).split("."),t=Xa("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=Gs(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||Gs(0==s[2].length,0==i[2].length)||Gs(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=se(this.pa,this)):this.A=di(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Gu(this,i)}},E.pa=function(){void 0!==Bs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,oe(this,"timeout"),this.abort(8))},E.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,oe(this,"complete"),oe(this,"abort"),$r(this))},E.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),$r(this,!0)),K.Z.M.call(this)},E.Fa=function(){this.s||(this.F||this.v||this.l?zu(this):this.cb())},E.cb=function(){zu(this)},E.ba=function(){try{return 2<ze(this)?this.g.status:-1}catch(n){return-1}},E.ga=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},E.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),If(e)}},E.Da=function(){return this.m},E.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(E=Wu.prototype).ma=8,E.G=1,E.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch(e){}},E.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const s=new Fn(this,this.h,n,void 0);let i=this.s;if(this.P&&(i?(i=nu(i),su(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){var r=this.l[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Xu(this,s,e),U(t=$e(this.F),"RID",n),U(t,"CVER",22),this.D&&U(t,"X-HTTP-Session-Id",this.D),Kn(this,t),this.o&&i&&bi(t,this.o,i),Ii(this.i,s),this.Ra&&U(t,"TYPE","init"),this.ja?(U(t,"$req",e),U(t,"SID","null"),s.$=!0,vi(s,t,null)):vi(s,t,e),this.G=2}}else 3==this.G&&(n?Ju(this,n):0==this.l.length||Uu(this.i)||Ju(this))},E.Ga=function(){if(this.u=null,tc(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Rn(se(this.bb,this),n)}},E.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ve(10),zr(this),tc(this))},E.ab=function(){null!=this.v&&(this.v=null,zr(this),Di(this),ve(19))},E.jb=function(n){n?(this.h.info("Successfully pinged google.com"),ve(2)):(this.h.info("Failed to ping google.com"),ve(1))},(E=ac.prototype).xa=function(){},E.wa=function(){},E.va=function(){},E.ua=function(){},E.Oa=function(){},Wr.prototype.g=function(n,e){return new be(n,e)},ie(be,X),be.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),ui(se(n.hb,n,e))),ve(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=ic(n,null,n.W),Qr(n)},be.prototype.close=function(){Ai(this.g)},be.prototype.u=function(n){if("string"==typeof n){var e={};e.__data__=n,Ci(this.g,e)}else this.v?((e={}).__data__=ai(n),Ci(this.g,e)):Ci(this.g,n)},be.prototype.M=function(){this.g.j=null,delete this.j,Ai(this.g),delete this.g,be.Z.M.call(this)},ie(uc,mi),ie(cc,pi),ie($t,ac),$t.prototype.xa=function(){oe(this.g,"a")},$t.prototype.wa=function(n){oe(this.g,new uc(n))},$t.prototype.va=function(n){oe(this.g,new cc(n))},$t.prototype.ua=function(){oe(this.g,"b")},Wr.prototype.createWebChannel=Wr.prototype.g,be.prototype.send=be.prototype.u,be.prototype.open=be.prototype.m,be.prototype.close=be.prototype.close,Or.NO_ERROR=0,Or.TIMEOUT=8,Or.HTTP_ERROR=6,xu.COMPLETE="complete",bu.EventType=Ln,Ln.OPEN="a",Ln.CLOSE="b",Ln.ERROR="c",Ln.MESSAGE="d",X.prototype.listen=X.prototype.N,K.prototype.listenOnce=K.prototype.O,K.prototype.getLastError=K.prototype.La,K.prototype.getLastErrorCode=K.prototype.Da,K.prototype.getStatus=K.prototype.ba,K.prototype.getResponseJson=K.prototype.Qa,K.prototype.getResponseText=K.prototype.ga,K.prototype.send=K.prototype.ea;var Nf=Ge.createWebChannelTransport=function(){return new Wr},kf=Ge.getStatEventTarget=function(){return Mr()},ki=Ge.ErrorCode=Or,Rf=Ge.EventType=xu,Lf=Ge.Event=vt,lc=Ge.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Ff=Ge.FetchXmlHttpFactory=Vn,Yr=Ge.WebChannel=bu,Mf=Ge.XhrIo=K;const hc="@firebase/firestore";class ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ae.UNAUTHENTICATED=new ae(null),ae.GOOGLE_CREDENTIALS=new ae("google-credentials-uid"),ae.FIRST_PARTY=new ae("first-party-uid"),ae.MOCK_USER=new ae("mock-user");let zt="9.6.5";const rt=new yt.Yd("@firebase/firestore");function Ri(){return rt.logLevel}function _(n,...e){if(rt.logLevel<=yt.in.DEBUG){const t=e.map(Li);rt.debug(`Firestore (${zt}): ${n}`,...t)}}function G(n,...e){if(rt.logLevel<=yt.in.ERROR){const t=e.map(Li);rt.error(`Firestore (${zt}): ${n}`,...t)}}function Gn(n,...e){if(rt.logLevel<=yt.in.WARN){const t=e.map(Li);rt.warn(`Firestore (${zt}): ${n}`,...t)}}function Li(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function x(n="Unexpected state"){const e=`FIRESTORE (${zt}) INTERNAL ASSERTION FAILED: `+n;throw G(e),new Error(e)}function b(n,e){n||x()}function T(n,e){return n}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class v extends F.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ee{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class dc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ae.UNAUTHENTICATED))}shutdown(){}}class Uf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Vf{constructor(e){this.t=e,this.currentUser=ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let o=new ee;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ee,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield i(r.currentUser)}))},u=c=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ee)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(b("string"==typeof r.accessToken),new dc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return b(null===e||"string"==typeof e),new ae(e)}}class Bf{constructor(e,t,r){this.type="FirstParty",this.user=ae.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const s=e.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class jf{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new Bf(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class fc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zf{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=s=>{e.enqueueRetryable(()=>{return null!=(i=s).error&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`),t(i.token);var i})};const r=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.g.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.g.getImmediate({optional:!0});s?r(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(b("string"==typeof t.token),new fc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Ae{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.p(r),this.T=r=>t.writeSequenceNumber(r))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function Kf(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}Ae.I=-1;class mc{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=Kf(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function k(n,e){return n<e?-1:n>e?1:0}function Qt(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function pc(n){return n+"\0"}class te{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new v(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new v(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new v(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new v(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return te.fromMillis(Date.now())}static fromDate(e){return te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new te(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?k(this.nanoseconds,e.nanoseconds):k(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class D{constructor(e){this.timestamp=e}static fromTimestamp(e){return new D(e)}static min(){return new D(new te(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function gc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function It(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function yc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class $n{constructor(e,t,r){void 0===t?t=0:t>e.length&&x(),void 0===r?r=e.length-t:r>e.length-t&&x(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===$n.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class M extends $n{construct(e,t,r){return new M(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new v(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new M(t)}static emptyPath(){return new M([])}}const Gf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends $n{construct(e,t,r){return new ue(e,t,r)}static isValidIdentifier(e){return Gf.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new v(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new v(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new v(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new v(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ue(t)}static emptyPath(){return new ue([])}}class Ht{constructor(e){this.fields=e,e.sort(ue.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qt(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class W{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new W(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new W(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return k(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}W.EMPTY_BYTE_STRING=new W("");const zf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function st(n){if(b(!!n),"string"==typeof n){let e=0;const t=zf.exec(n);if(b(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$(n.seconds),nanos:$(n.nanos)}}function $(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Wt(n){return"string"==typeof n?W.fromBase64String(n):W.fromUint8Array(n)}function Fi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function vc(n){const e=n.mapValue.fields.__previous_value__;return Fi(e)?vc(e):e}function zn(n){const e=st(n.mapValue.fields.__local_write_time__.timestampValue);return new te(e.seconds,e.nanos)}function xt(n){return null==n}function Jr(n){return 0===n&&1/n==-1/0}function wc(n){return"number"==typeof n&&Number.isInteger(n)&&!Jr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class I{constructor(e){this.path=e}static fromPath(e){return new I(M.fromString(e))}static fromName(e){return new I(M.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===M.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return M.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new I(new M(e.slice()))}}function St(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Fi(n)?4:10:x()}function qe(n,e){if(n===e)return!0;const t=St(n);if(t!==St(e))return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zn(n).isEqual(zn(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=st(r.timestampValue),o=st(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Wt(n.bytesValue).isEqual(Wt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return $(r.geoPointValue.latitude)===$(s.geoPointValue.latitude)&&$(r.geoPointValue.longitude)===$(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return $(r.integerValue)===$(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=$(r.doubleValue),o=$(s.doubleValue);return i===o?Jr(i)===Jr(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return Qt(n.arrayValue.values||[],e.arrayValue.values||[],qe);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(gc(i)!==gc(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!qe(i[a],o[a])))return!1;return!0}(n,e);default:return x()}var s}function Qn(n,e){return void 0!==(n.values||[]).find(t=>qe(t,e))}function Yt(n,e){if(n===e)return 0;const t=St(n),r=St(e);if(t!==r)return k(t,r);switch(t){case 0:return 0;case 1:return k(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=$(s.integerValue||s.doubleValue),a=$(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return _c(n.timestampValue,e.timestampValue);case 4:return _c(zn(n),zn(e));case 5:return k(n.stringValue,e.stringValue);case 6:return function(s,i){const o=Wt(s),a=Wt(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const c=k(o[u],a[u]);if(0!==c)return c}return k(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=k($(s.latitude),$(i.latitude));return 0!==o?o:k($(s.longitude),$(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const c=Yt(o[u],a[u]);if(c)return c}return k(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){const o=s.fields||{},a=Object.keys(o),u=i.fields||{},c=Object.keys(u);a.sort(),c.sort();for(let h=0;h<a.length&&h<c.length;++h){const d=k(a[h],c[h]);if(0!==d)return d;const f=Yt(o[a[h]],u[c[h]]);if(0!==f)return f}return k(a.length,c.length)}(n.mapValue,e.mapValue);default:throw x()}}function _c(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return k(n,e);const t=st(n),r=st(e),s=k(t.seconds,r.seconds);return 0!==s?s:k(t.nanos,r.nanos)}function Mi(n){return Oi(n)}function Oi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=st(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Wt(n.bytesValue).toBase64():"referenceValue"in n?I.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=Oi(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${Oi(r.fields[a])}`;return i+"}"}(n.mapValue):x();var e}function Xr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Pi(n){return!!n&&"integerValue"in n}function qi(n){return!!n&&"arrayValue"in n}function Tc(n){return!!n&&"nullValue"in n}function Ec(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function es(n){return!!n&&"mapValue"in n}function Hn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return It(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Hn(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Hn(n.arrayValue.values[t]);return e}return Object.assign({},n)}class de{constructor(e){this.value=e}static empty(){return new de({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!es(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Hn(t)}setAll(e){let t=ue.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Hn(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());es(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];es(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){It(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new de(Hn(this.value))}}function Ic(n){const e=[];return It(n.fields,(t,r)=>{const s=new ue([t]);if(es(r)){const i=Ic(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ht(e)}class V{constructor(e,t,r,s,i){this.key=e,this.documentType=t,this.version=r,this.data=s,this.documentState=i}static newInvalidDocument(e){return new V(e,0,D.min(),de.empty(),0)}static newFoundDocument(e,t,r){return new V(e,1,t,r,0)}static newNoDocument(e,t){return new V(e,2,t,de.empty(),0)}static newUnknownDocument(e,t){return new V(e,3,t,de.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=de.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=de.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof V&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new V(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Qf{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.R=null}}function xc(n,e=null,t=[],r=[],s=null,i=null,o=null){return new Qf(n,e,t,r,s,i,o)}function Wn(n){const e=T(n);if(null===e.R){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>function Wf(n){return n.field.canonicalString()+n.op.toString()+Mi(n.value)}(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),xt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=rs(e.startAt)),e.endAt&&(t+="|ub:",t+=rs(e.endAt)),e.R=t}return e.R}function ts(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!sm(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if((t=n.filters[s]).op!==(r=e.filters[s]).op||!t.field.isEqual(r.field)||!qe(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ac(n.startAt,e.startAt)&&Ac(n.endAt,e.endAt)}function ns(n){return I.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class we extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,r):new Yf(e,t,r):"array-contains"===t?new em(e,r):"in"===t?new tm(e,r):"not-in"===t?new nm(e,r):"array-contains-any"===t?new rm(e,r):new we(e,t,r)}static P(e,t,r){return"in"===t?new Jf(e,r):new Xf(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Yt(t,this.value)):null!==t&&St(this.value)===St(t)&&this.v(Yt(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return x()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Yf extends we{constructor(e,t,r){super(e,t,r),this.key=I.fromName(r.referenceValue)}matches(e){const t=I.comparator(e.key,this.key);return this.v(t)}}class Jf extends we{constructor(e,t){super(e,"in",t),this.keys=Sc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Xf extends we{constructor(e,t){super(e,"not-in",t),this.keys=Sc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Sc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>I.fromName(r.referenceValue))}class em extends we{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return qi(t)&&Qn(t.arrayValue,this.value)}}class tm extends we{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Qn(this.value.arrayValue,t)}}class nm extends we{constructor(e,t){super(e,"not-in",t)}matches(e){if(Qn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Qn(this.value.arrayValue,t)}}class rm extends we{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!qi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Qn(this.value.arrayValue,r))}}class Yn{constructor(e,t){this.position=e,this.before=t}}function rs(n){return`${n.before?"b":"a"}:${n.position.map(e=>Mi(e)).join(",")}`}class Jt{constructor(e,t="asc"){this.field=e,this.dir=t}}function sm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function bc(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?I.comparator(I.fromName(o.referenceValue),t.key):Yt(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return n.before?r<=0:r<0}function Ac(n,e){if(null===n)return null===e;if(null===e||n.before!==e.before||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qe(n.position[t],e.position[t]))return!1;return!0}class Qe{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.S=null,this.D=null}}function Cc(n,e,t,r,s,i,o,a){return new Qe(n,e,t,r,s,i,o,a)}function Xt(n){return new Qe(n)}function ss(n){return!xt(n.limit)&&"F"===n.limitType}function is(n){return!xt(n.limit)&&"L"===n.limitType}function Ui(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Vi(n){for(const e of n.filters)if(e.V())return e.field;return null}function Bi(n){return null!==n.collectionGroup}function en(n){const e=T(n);if(null===e.S){e.S=[];const t=Vi(e),r=Ui(e);if(null!==t&&null===r)t.isKeyField()||e.S.push(new Jt(t)),e.S.push(new Jt(ue.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.S.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.S.push(new Jt(ue.keyField(),i))}}}return e.S}function Re(n){const e=T(n);if(!e.D)if("F"===e.limitType)e.D=xc(e.path,e.collectionGroup,en(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of en(e))t.push(new Jt(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new Yn(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Yn(e.startAt.position,!e.startAt.before):null;e.D=xc(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e.D}function Dc(n,e,t){return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Jn(n,e){return ts(Re(n),Re(e))&&n.limitType===e.limitType}function Nc(n){return`${Wn(Re(n))}|lt:${n.limitType}`}function ji(n){return`Query(target=${function Hf(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${Mi(r.value)}`;var r}).join(", ")}]`),xt(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: "+rs(n.startAt)),n.endAt&&(e+=", endAt: "+rs(n.endAt)),`Target(${e})`}(Re(n))}; limitType=${n.limitType})`}function Xn(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):I.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of t.explicitOrderBy)if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!bc(t.startAt,en(t),r)||t.endAt&&bc(t.endAt,en(t),r)));var t,r}function kc(n){return(e,t)=>{let r=!1;for(const s of en(n)){const i=im(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function im(n,e,t){const r=n.field.isKeyField()?I.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?Yt(a,u):x()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return x()}}function Rc(n,e){if(n.C){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jr(e)?"-0":e}}function Lc(n){return{integerValue:""+n}}function Fc(n,e){return wc(e)?Lc(e):Rc(n,e)}class os{constructor(){this._=void 0}}function om(n,e,t){return n instanceof tn?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof bt?Oc(n,e):n instanceof At?Pc(n,e):function(r,s){const i=Mc(r,s),o=qc(i)+qc(r.N);return Pi(i)&&Pi(r.N)?Lc(o):Rc(r.k,o)}(n,e)}function am(n,e,t){return n instanceof bt?Oc(n,e):n instanceof At?Pc(n,e):t}function Mc(n,e){return n instanceof nn?Pi(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class tn extends os{}class bt extends os{constructor(e){super(),this.elements=e}}function Oc(n,e){const t=Uc(e);for(const r of n.elements)t.some(s=>qe(s,r))||t.push(r);return{arrayValue:{values:t}}}class At extends os{constructor(e){super(),this.elements=e}}function Pc(n,e){let t=Uc(e);for(const r of n.elements)t=t.filter(s=>!qe(s,r));return{arrayValue:{values:t}}}class nn extends os{constructor(e,t){super(),this.k=e,this.N=t}}function qc(n){return $(n.integerValue||n.doubleValue)}function Uc(n){return qi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class er{constructor(e,t){this.field=e,this.transform=t}}class cm{constructor(e,t){this.version=e,this.transformResults=t}}class z{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new z}static exists(e){return new z(void 0,e)}static updateTime(e){return new z(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function as(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class us{}function lm(n,e,t){n instanceof tr?function(r,s,i){const o=r.value.clone(),a=Zc(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof it?function(r,s,i){if(!as(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=Zc(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(jc(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Zi(n,e,t){var s;n instanceof tr?function(r,s,i){if(!as(r.precondition,s))return;const o=r.value.clone(),a=Kc(r.fieldTransforms,i,s);o.setAll(a),s.convertToFoundDocument(Bc(s),o).setHasLocalMutations()}(n,e,t):n instanceof it?function(r,s,i){if(!as(r.precondition,s))return;const o=Kc(r.fieldTransforms,i,s),a=s.data;a.setAll(jc(r)),a.setAll(o),s.convertToFoundDocument(Bc(s),a).setHasLocalMutations()}(n,e,t):as(n.precondition,s=e)&&s.convertToNoDocument(D.min())}function hm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Mc(r.transform,s||null);null!=i&&(null==t&&(t=de.empty()),t.set(r.field,i))}return t||null}function Vc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Qt(t,r,(s,i)=>function um(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof bt&&r instanceof bt||t instanceof At&&r instanceof At?Qt(t.elements,r.elements,qe):t instanceof nn&&r instanceof nn?qe(t.N,r.N):t instanceof tn&&r instanceof tn);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}function Bc(n){return n.isFoundDocument()?n.version:D.min()}class tr extends us{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}}class it extends us{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}}function jc(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Zc(n,e,t){const r=new Map;b(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,am(o,a,t[s]))}return r}function Kc(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,om(i,o,e))}return r}class nr extends us{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Ki extends us{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class dm{constructor(e){this.count=e}}var Q,L;function Gc(n){switch(n){default:return x();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function $c(n){if(void 0===n)return G("GRPC error has no .code"),m.UNKNOWN;switch(n){case Q.OK:return m.OK;case Q.CANCELLED:return m.CANCELLED;case Q.UNKNOWN:return m.UNKNOWN;case Q.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case Q.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case Q.INTERNAL:return m.INTERNAL;case Q.UNAVAILABLE:return m.UNAVAILABLE;case Q.UNAUTHENTICATED:return m.UNAUTHENTICATED;case Q.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case Q.NOT_FOUND:return m.NOT_FOUND;case Q.ALREADY_EXISTS:return m.ALREADY_EXISTS;case Q.PERMISSION_DENIED:return m.PERMISSION_DENIED;case Q.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case Q.ABORTED:return m.ABORTED;case Q.OUT_OF_RANGE:return m.OUT_OF_RANGE;case Q.UNIMPLEMENTED:return m.UNIMPLEMENTED;case Q.DATA_LOSS:return m.DATA_LOSS;default:return x()}}(L=Q||(Q={}))[L.OK=0]="OK",L[L.CANCELLED=1]="CANCELLED",L[L.UNKNOWN=2]="UNKNOWN",L[L.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",L[L.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",L[L.NOT_FOUND=5]="NOT_FOUND",L[L.ALREADY_EXISTS=6]="ALREADY_EXISTS",L[L.PERMISSION_DENIED=7]="PERMISSION_DENIED",L[L.UNAUTHENTICATED=16]="UNAUTHENTICATED",L[L.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",L[L.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",L[L.ABORTED=10]="ABORTED",L[L.OUT_OF_RANGE=11]="OUT_OF_RANGE",L[L.UNIMPLEMENTED=12]="UNIMPLEMENTED",L[L.INTERNAL=13]="INTERNAL",L[L.UNAVAILABLE=14]="UNAVAILABLE",L[L.DATA_LOSS=15]="DATA_LOSS";class Y{constructor(e,t){this.comparator=e,this.root=t||ce.EMPTY}insert(e,t){return new Y(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ce.BLACK,null,null))}remove(e){return new Y(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ce.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cs(this.root,e,this.comparator,!1)}getReverseIterator(){return new cs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cs(this.root,e,this.comparator,!0)}}class cs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ce{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=null!=r?r:ce.RED,this.left=null!=s?s:ce.EMPTY,this.right=null!=i?i:ce.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ce(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ce.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return ce.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ce.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ce.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw x();const e=this.left.check();if(e!==this.right.check())throw x();return e+(this.isRed()?0:1)}}ce.EMPTY=null,ce.RED=!0,ce.BLACK=!1,ce.EMPTY=new class{constructor(){this.size=0}get key(){throw x()}get value(){throw x()}get color(){throw x()}get left(){throw x()}get right(){throw x()}copy(n,e,t,r,s){return this}insert(n,e,t){return new ce(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class j{constructor(e){this.comparator=e,this.data=new Y(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zc(this.data.getIterator())}getIteratorFrom(e){return new zc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof j)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new j(this.comparator);return t.data=e,t}}class zc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const fm=new Y(I.comparator);function Le(){return fm}const mm=new Y(I.comparator);function Gi(){return mm}const pm=new Y(I.comparator);function Qc(){return pm}const gm=new j(I.comparator);function O(...n){let e=gm;for(const t of n)e=e.add(t);return e}const ym=new j(k);function ls(){return ym}class rr{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const r=new Map;return r.set(e,sr.createSynthesizedTargetChangeForCurrentChange(e,t)),new rr(D.min(),r,ls(),Le(),O())}}class sr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new sr(W.EMPTY_BYTE_STRING,t,O(),O(),O())}}class hs{constructor(e,t,r,s){this.$=e,this.removedTargetIds=t,this.key=r,this.O=s}}class Hc{constructor(e,t){this.targetId=e,this.M=t}}class Wc{constructor(e,t,r=W.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Yc{constructor(){this.F=0,this.L=Xc(),this.B=W.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=O(),t=O(),r=O();return this.L.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:x()}}),new sr(this.B,this.U,e,t,r)}H(){this.q=!1,this.L=Xc()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class vm{constructor(e){this.et=e,this.nt=new Map,this.st=Le(),this.it=Jc(),this.rt=new j(k)}ot(e){for(const t of e.$)e.O&&e.O.isFoundDocument()?this.ct(t,e.O):this.at(t,e.key,e.O);for(const t of e.removedTargetIds)this.at(t,e.key,e.O)}ut(e){this.forEachTarget(e,t=>{const r=this.ht(t);switch(e.state){case 0:this.lt(t)&&r.W(e.resumeToken);break;case 1:r.Z(),r.K||r.H(),r.W(e.resumeToken);break;case 2:r.Z(),r.K||this.removeTarget(t);break;case 3:this.lt(t)&&(r.tt(),r.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),r.W(e.resumeToken));break;default:x()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((r,s)=>{this.lt(s)&&t(s)})}dt(e){const t=e.targetId,r=e.M.count,s=this.wt(t);if(s){const i=s.target;if(ns(i))if(0===r){const o=new I(i.path);this.at(t,o,V.newNoDocument(o,D.min()))}else b(1===r);else this._t(t)!==r&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach((i,o)=>{const a=this.wt(o);if(a){if(i.current&&ns(a.target)){const u=new I(a.target.path);null!==this.st.get(u)||this.yt(o,u)||this.at(o,u,V.newNoDocument(u,e))}i.j&&(t.set(o,i.G()),i.H())}});let r=O();this.it.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.wt(u);return!c||2===c.purpose||(a=!1,!1)}),a&&(r=r.add(i))});const s=new rr(e,t,this.rt,this.st,r);return this.st=Le(),this.it=Jc(),this.rt=new j(k),s}ct(e,t){if(!this.lt(e))return;const r=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,r),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}at(e,t,r){if(!this.lt(e))return;const s=this.ht(e);this.yt(e,t)?s.J(t,1):s.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),r&&(this.st=this.st.insert(t,r))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new Yc,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new j(k),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||_("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new Yc),this.et.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function Jc(){return new Y(I.comparator)}function Xc(){return new Y(I.comparator)}const wm={asc:"ASCENDING",desc:"DESCENDING"},_m={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Tm{constructor(e,t){this.databaseId=e,this.C=t}}function ir(n,e){return n.C?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function el(n,e){return n.C?e.toBase64():e.toUint8Array()}function Em(n,e){return ir(n,e.toTimestamp())}function ne(n){return b(!!n),D.fromTimestamp(function(e){const t=st(e);return new te(t.seconds,t.nanos)}(n))}function $i(n,e){return(t=n,new M(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function tl(n){const e=M.fromString(n);return b(fl(e)),e}function or(n,e){return $i(n.databaseId,e.path)}function Ue(n,e){const t=tl(e);if(t.get(1)!==n.databaseId.projectId)throw new v(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new v(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new I(rl(t))}function zi(n,e){return $i(n.databaseId,e)}function nl(n){const e=tl(n);return 4===e.length?M.emptyPath():rl(e)}function ar(n){return new M(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function rl(n){return b(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function sl(n,e,t){return{name:or(n,e),fields:t.value.mapValue.fields}}function il(n,e,t){const r=Ue(n,e.name),s=ne(e.updateTime),i=new de({mapValue:{fields:e.fields}}),o=V.newFoundDocument(r,s,i);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function ds(n,e){let t;if(e instanceof tr)t={update:sl(n,e.key,e.value)};else if(e instanceof nr)t={delete:or(n,e.key)};else if(e instanceof it)t={update:sl(n,e.key,e.data),updateMask:km(e.fieldMask)};else{if(!(e instanceof Ki))return x();t={verify:or(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof tn)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof bt)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof At)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof nn)return{fieldPath:i.field.canonicalString(),increment:o.N};throw x()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Em(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:x()),t;var s}function ol(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?z.updateTime(ne(s.updateTime)):void 0!==s.exists?z.exists(s.exists):z.none():z.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(b("REQUEST_TIME"===o.setToServerValue),a=new tn):"appendMissingElements"in o?a=new bt(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new At(o.removeAllFromArray.values||[]):"increment"in o?a=new nn(i,o.increment):x();const u=ue.fromServerFormat(o.fieldPath);return new er(u,a)}(n,s)):[];var s;if(e.update){const s=Ue(n,e.update.name),i=new de({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ht((e.updateMask.fieldPaths||[]).map(c=>ue.fromServerFormat(c)));return new it(s,i,o,t,r)}return new tr(s,i,t,r)}if(e.delete){const s=Ue(n,e.delete);return new nr(s,t)}if(e.verify){const s=Ue(n,e.verify);return new Ki(s,t)}return x()}function al(n,e){return{documents:[zi(n,e.path)]}}function ul(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=zi(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=zi(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(a){if(0===a.length)return;const u=a.map(c=>function(h){if("=="===h.op){if(Ec(h.value))return{unaryFilter:{field:rn(h.field),op:"IS_NAN"}};if(Tc(h.value))return{unaryFilter:{field:rn(h.field),op:"IS_NULL"}}}else if("!="===h.op){if(Ec(h.value))return{unaryFilter:{field:rn(h.field),op:"IS_NOT_NAN"}};if(Tc(h.value))return{unaryFilter:{field:rn(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:rn(h.field),op:Cm(h.op),value:h.value}}}(c));return 1===u.length?u[0]:{compositeFilter:{op:"AND",filters:u}}}(e.filters);s&&(t.structuredQuery.where=s);const i=function(a){if(0!==a.length)return a.map(u=>{return{field:rn((c=u).field),direction:Am(c.dir)};var c})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(u=e.limit,n.C||xt(u)?u:{value:u});var u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=hl(e.startAt)),e.endAt&&(t.structuredQuery.endAt=hl(e.endAt)),t}function cl(n){let e=nl(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){b(1===r);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=ll(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(h=>{return new Jt(sn((d=h).field),function(f){switch(f){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(d.direction));var d}));let a=null;t.limit&&(a=function(h){let d;return d="object"==typeof h?h.value:h,xt(d)?null:d}(t.limit));let u=null;t.startAt&&(u=dl(t.startAt));let c=null;return t.endAt&&(c=dl(t.endAt)),Cc(e,s,o,i,a,"F",u,c)}function ll(n){return n?void 0!==n.unaryFilter?[Nm(n)]:void 0!==n.fieldFilter?[Dm(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>ll(e)).reduce((e,t)=>e.concat(t)):x():[]}function hl(n){return{before:n.before,values:n.position}}function dl(n){return new Yn(n.values||[],!!n.before)}function Am(n){return wm[n]}function Cm(n){return _m[n]}function rn(n){return{fieldPath:n.canonicalString()}}function sn(n){return ue.fromServerFormat(n.fieldPath)}function Dm(n){return we.create(sn(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return x()}}(n.fieldFilter.op),n.fieldFilter.value)}function Nm(n){switch(n.unaryFilter.op){case"IS_NAN":const e=sn(n.unaryFilter.field);return we.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=sn(n.unaryFilter.field);return we.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=sn(n.unaryFilter.field);return we.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=sn(n.unaryFilter.field);return we.create(s,"!=",{nullValue:"NULL_VALUE"});default:return x()}}function km(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function fl(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function Me(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ml(e)),e=Rm(n.get(t),e);return ml(e)}function Rm(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function ml(n){return n+"\x01\x01"}function He(n){const e=n.length;if(b(e>=2),2===e)return b("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),M.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&x(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:x()}i=o+2}return new M(r)}class Lm{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Ce{constructor(e,t,r){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=r}}Ce.store="owner",Ce.key="owner";class ot{constructor(e,t,r){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=r}}ot.store="mutationQueues",ot.keyPath="userId";class P{constructor(e,t,r,s,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=r,this.baseMutations=s,this.mutations=i}}P.store="mutations",P.keyPath="batchId",P.userMutationsIndex="userMutationsIndex",P.userMutationsKeyPath=["userId","batchId"];class fe{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Me(t)]}static key(e,t,r){return[e,Me(t),r]}}fe.store="documentMutations",fe.PLACEHOLDER=new fe;class Fm{constructor(e,t){this.path=e,this.readTime=t}}class Mm{constructor(e,t){this.path=e,this.version=t}}class Z{constructor(e,t,r,s,i,o){this.unknownDocument=e,this.noDocument=t,this.document=r,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=o}}Z.store="remoteDocuments",Z.readTimeIndex="readTimeIndex",Z.readTimeIndexPath="readTime",Z.collectionReadTimeIndex="collectionReadTimeIndex",Z.collectionReadTimeIndexPath=["parentPath","readTime"];class Ve{constructor(e){this.byteSize=e}}Ve.store="remoteDocumentGlobal",Ve.key="remoteDocumentGlobalKey";class Ee{constructor(e,t,r,s,i,o,a){this.targetId=e,this.canonicalId=t,this.readTime=r,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}}Ee.store="targets",Ee.keyPath="targetId",Ee.queryTargetsIndexName="queryTargetsIndex",Ee.queryTargetsKeyPath=["canonicalId","targetId"];class le{constructor(e,t,r){this.targetId=e,this.path=t,this.sequenceNumber=r}}le.store="targetDocuments",le.keyPath=["targetId","path"],le.documentTargetsIndex="documentTargetsIndex",le.documentTargetsKeyPath=["path","targetId"];class De{constructor(e,t,r,s){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=r,this.targetCount=s}}De.key="targetGlobalKey",De.store="targetGlobal";class Ct{constructor(e,t){this.collectionId=e,this.parent=t}}Ct.store="collectionParents",Ct.keyPath=["collectionId","parent"];class We{constructor(e,t,r,s){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=r,this.inForeground=s}}We.store="clientMetadata",We.keyPath="clientId";class on{constructor(e,t,r){this.bundleId=e,this.createTime=t,this.version=r}}on.store="bundles",on.keyPath="bundleId";class an{constructor(e,t,r){this.name=e,this.readTime=t,this.bundledQuery=r}}an.store="namedQueries",an.keyPath="name";const Om=[ot.store,P.store,fe.store,Z.store,Ee.store,Ce.store,De.store,le.store,We.store,Ve.store,Ct.store,on.store,an.store],pl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class gl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class y{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&x(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new y((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof y?t:y.resolve(t)}catch(t){return y.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):y.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):y.reject(t)}static resolve(e){return new y((t,r)=>{t(e)})}static reject(e){return new y((t,r)=>{r(e)})}static waitFor(e){return new y((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=y.resolve(!1);for(const r of e)t=t.next(s=>s?y.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}}class fs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.It=new ee,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{t.error?this.It.reject(new ur(e,t.error)):this.It.resolve()},this.transaction.onerror=r=>{const s=Qi(r.target.error);this.It.reject(new ur(e,s))}}static open(e,t,r,s){try{return new fs(t,e.transaction(s,r))}catch(i){throw new ur(t,i)}}get At(){return this.It.promise}abort(e){e&&this.It.reject(e),this.aborted||(_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new qm(t)}}class Oe{constructor(e,t,r){this.name=e,this.version=t,this.Rt=r,12.2===Oe.bt((0,F.z$)())&&G("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return _("SimpleDb","Removing database:",e),Nt(window.indexedDB.deleteDatabase(e)).toPromise()}static Pt(){if(!(0,F.hl)())return!1;if(Oe.vt())return!0;const e=(0,F.z$)(),t=Oe.bt(e),r=0<t&&t<10,s=Oe.Vt(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static vt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.St)}static Dt(e,t){return e.store(t)}static bt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static Vt(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}Ct(e){var t=this;return(0,p.Z)(function*(){return t.db||(_("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new ur(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new v(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new v(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new ur(e,a))},i.onupgradeneeded=o=>{_("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.Rt.Nt(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{_("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.kt&&(t.db.onversionchange=r=>t.kt(r)),t.db})()}xt(e){this.kt=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,p.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.Ct(e);const u=fs.open(i.db,e,o?"readonly":"readwrite",r),c=s(u).catch(h=>(u.abort(h),y.reject(h))).toPromise();return c.catch(()=>{}),yield u.At,c}catch(u){const c="FirebaseError"!==u.name&&a<3;if(_("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),i.close(),!c)return Promise.reject(u)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Pm{constructor(e){this.$t=e,this.Ot=!1,this.Mt=null}get isDone(){return this.Ot}get Ft(){return this.Mt}set cursor(e){this.$t=e}done(){this.Ot=!0}Lt(e){this.Mt=e}delete(){return Nt(this.$t.delete())}}class ur extends v{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Dt(n){return"IndexedDbTransactionError"===n.name}class qm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(_("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Nt(r)}add(e){return _("SimpleDb","ADD",this.store.name,e,e),Nt(this.store.add(e))}get(e){return Nt(this.store.get(e)).next(t=>(void 0===t&&(t=null),_("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return _("SimpleDb","DELETE",this.store.name,e),Nt(this.store.delete(e))}count(){return _("SimpleDb","COUNT",this.store.name),Nt(this.store.count())}Bt(e,t){const r=this.cursor(this.options(e,t)),s=[];return this.Ut(r,(i,o)=>{s.push(o)}).next(()=>s)}qt(e,t){_("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Kt=!1;const s=this.cursor(r);return this.Ut(s,(i,o,a)=>a.delete())}jt(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.Ut(s,t)}Qt(e){const t=this.cursor({});return new y((r,s)=>{t.onerror=i=>{const o=Qi(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}Ut(e,t){const r=[];return new y((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new Pm(a),c=t(a.primaryKey,a.value,u);if(c instanceof y){const h=c.catch(d=>(u.done(),y.reject(d)));r.push(h)}u.isDone?s():null===u.Ft?a.continue():a.continue(u.Ft)}}).next(()=>y.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Kt?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Nt(n){return new y((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=Qi(r.target.error);t(s)}})}let yl=!1;function Qi(n){const e=Oe.bt((0,F.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new v("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return yl||(yl=!0,setTimeout(()=>{throw r},0)),r}}return n}class vl extends gl{constructor(e,t){super(),this.Wt=e,this.currentSequenceNumber=t}}function Ie(n,e){const t=T(n);return Oe.Dt(t.Wt,e)}class Hi{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&lm(i,e,r[s])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Zi(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Zi(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const r=e.get(t.key),s=r;this.applyToLocalView(s),r.isValidDocument()||s.convertToNoDocument(D.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),O())}isEqual(e){return this.batchId===e.batchId&&Qt(this.mutations,e.mutations,(t,r)=>Vc(t,r))&&Qt(this.baseMutations,e.baseMutations,(t,r)=>Vc(t,r))}}class Wi{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){b(e.mutations.length===r.length);let s=Qc();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Wi(e,t,r,s)}}class at{constructor(e,t,r,s,i=D.min(),o=D.min(),a=W.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new at(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new at(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new at(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class wl{constructor(e){this.Gt=e}}function Yi(n,e){if(e.document)return il(n.Gt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=I.fromSegments(e.noDocument.path),r=cn(e.noDocument.readTime),s=V.newNoDocument(t,r);return e.hasCommittedMutations?s.setHasCommittedMutations():s}if(e.unknownDocument){const t=I.fromSegments(e.unknownDocument.path),r=cn(e.unknownDocument.version);return V.newUnknownDocument(t,r)}return x()}function _l(n,e,t){const r=Ji(t),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const i={name:or(a=n.Gt,(u=e).key),fields:u.data.value.mapValue.fields,updateTime:ir(a,u.version.toTimestamp())};return new Z(null,null,i,e.hasCommittedMutations,r,s)}var a,u;if(e.isNoDocument()){const i=e.key.path.toArray(),o=un(e.version),a=e.hasCommittedMutations;return new Z(null,new Fm(i,o),null,a,r,s)}if(e.isUnknownDocument()){const i=e.key.path.toArray(),o=un(e.version);return new Z(new Mm(i,o),null,null,!0,r,s)}return x()}function Ji(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Tl(n){const e=new te(n[0],n[1]);return D.fromTimestamp(e)}function un(n){const e=n.toTimestamp();return new Lm(e.seconds,e.nanoseconds)}function cn(n){const e=new te(n.seconds,n.nanoseconds);return D.fromTimestamp(e)}function ln(n,e){const t=(e.baseMutations||[]).map(i=>ol(n.Gt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(o.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(i=>ol(n.Gt,i)),s=te.fromMillis(e.localWriteTimeMs);return new Hi(e.batchId,s,t,r)}function cr(n){const e=cn(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?cn(n.lastLimboFreeSnapshotVersion):D.min();let r;var s;return void 0!==n.query.documents?(b(1===(s=n.query).documents.length),r=Re(Xt(nl(s.documents[0])))):r=Re(cl(n.query)),new at(r,n.targetId,0,n.lastListenSequenceNumber,e,t,W.fromBase64String(n.resumeToken))}function El(n,e){const t=un(e.snapshotVersion),r=un(e.lastLimboFreeSnapshotVersion);let s;s=ns(e.target)?al(n.Gt,e.target):ul(n.Gt,e.target);const i=e.resumeToken.toBase64();return new Ee(e.targetId,Wn(e.target),t,i,e.sequenceNumber,r,s)}function Xi(n){const e=cl({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Dc(e,e.limit,"L"):e}class Um{getBundleMetadata(e,t){return Il(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:cn(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Il(e).put({bundleId:(r=t).id,createTime:un(ne(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return xl(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Xi(s.bundledQuery),readTime:cn(s.readTime)};var s})}saveNamedQuery(e,t){return xl(e).put({name:(r=t).name,readTime:un(ne(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Il(n){return Ie(n,on.store)}function xl(n){return Ie(n,an.store)}class Vm{constructor(){this.zt=new eo}addToCollectionParentIndex(e,t){return this.zt.add(t),y.resolve()}getCollectionParents(e,t){return y.resolve(this.zt.getEntries(t))}}class eo{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new j(M.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new j(M.comparator)).toArray()}}class Bm{constructor(){this.Ht=new eo}addToCollectionParentIndex(e,t){if(!this.Ht.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.Ht.add(t)});const i={collectionId:r,parent:Me(s)};return Sl(e).put(i)}return y.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[pc(t),""],!1,!0);return Sl(e).Bt(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(He(o.parent))}return r})}}function Sl(n){return Ie(n,Ct.store)}const bl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class xe{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new xe(e,xe.DEFAULT_COLLECTION_PERCENTILE,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Al(n,e,t){const r=n.store(P.store),s=n.store(fe.store),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.jt({range:o},(h,d,f)=>(a++,f.delete()));i.push(u.next(()=>{b(1===a)}));const c=[];for(const h of t.mutations){const d=fe.key(e,h.key.path,t.batchId);i.push(s.delete(d)),c.push(h.key)}return y.waitFor(i).next(()=>c)}function ms(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw x();e=n.noDocument}return JSON.stringify(e).length}xe.DEFAULT_COLLECTION_PERCENTILE=10,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,xe.DEFAULT=new xe(41943040,xe.DEFAULT_COLLECTION_PERCENTILE,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),xe.DISABLED=new xe(-1,0,0);class to{constructor(e,t,r,s){this.userId=e,this.k=t,this.Jt=r,this.referenceDelegate=s,this.Yt={}}static Xt(e,t,r,s){b(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new to(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ut(e).jt({index:P.userMutationsIndex,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=hn(e),o=ut(e);return o.add({}).next(a=>{b("number"==typeof a);const u=new Hi(a,t,r,s),c=function(f,g,w){const S=w.baseMutations.map(J=>ds(f.Gt,J)),N=w.mutations.map(J=>ds(f.Gt,J));return new P(g,w.batchId,w.localWriteTime.toMillis(),S,N)}(this.k,this.userId,u),h=[];let d=new j((f,g)=>k(f.canonicalString(),g.canonicalString()));for(const f of s){const g=fe.key(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),h.push(o.put(c)),h.push(i.put(g,fe.PLACEHOLDER))}return d.forEach(f=>{h.push(this.Jt.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.Yt[a]=u.keys()}),y.waitFor(h).next(()=>u)})}lookupMutationBatch(e,t){return ut(e).get(t).next(r=>r?(b(r.userId===this.userId),ln(this.k,r)):null)}Zt(e,t){return this.Yt[t]?y.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Yt[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ut(e).jt({index:P.userMutationsIndex,range:s},(o,a,u)=>{a.userId===this.userId&&(b(a.batchId>=r),i=ln(this.k,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ut(e).jt({index:P.userMutationsIndex,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ut(e).Bt(P.userMutationsIndex,t).next(r=>r.map(s=>ln(this.k,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=fe.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return hn(e).jt({range:s},(o,a,u)=>{const[c,h,d]=o,f=He(h);if(c===this.userId&&t.path.isEqual(f))return ut(e).get(d).next(g=>{if(!g)throw x();b(g.userId===this.userId),i.push(ln(this.k,g))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new j(k);const s=[];return t.forEach(i=>{const o=fe.prefixForPath(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=hn(e).jt({range:a},(c,h,d)=>{const[f,g,w]=c,S=He(g);f===this.userId&&i.path.isEqual(S)?r=r.add(w):d.done()});s.push(u)}),y.waitFor(s).next(()=>this.te(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=fe.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new j(k);return hn(e).jt({range:o},(u,c,h)=>{const[d,f,g]=u,w=He(f);d===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(g)):h.done()}).next(()=>this.te(e,a))}te(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ut(e).get(i).next(o=>{if(null===o)throw x();b(o.userId===this.userId),r.push(ln(this.k,o))}))}),y.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Al(e.Wt,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ee(t.batchId)}),y.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ee(e){delete this.Yt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return y.resolve();const r=IDBKeyRange.lowerBound(fe.prefixForUser(this.userId)),s=[];return hn(e).jt({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=He(i[1]);s.push(u)}else a.done()}).next(()=>{b(0===s.length)})})}containsKey(e,t){return Cl(e,this.userId,t)}ne(e){return Dl(e).get(this.userId).next(t=>t||new ot(this.userId,-1,""))}}function Cl(n,e,t){const r=fe.prefixForPath(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return hn(n).jt({range:i,Kt:!0},(a,u,c)=>{const[h,d,f]=a;h===e&&d===s&&(o=!0),c.done()}).next(()=>o)}function ut(n){return Ie(n,P.store)}function hn(n){return Ie(n,fe.store)}function Dl(n){return Ie(n,ot.store)}class kt{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new kt(0)}static re(){return new kt(-1)}}class jm{constructor(e,t){this.referenceDelegate=e,this.k=t}allocateTargetId(e){return this.oe(e).next(t=>{const r=new kt(t.highestTargetId);return t.highestTargetId=r.next(),this.ce(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.oe(e).next(t=>D.fromTimestamp(new te(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.oe(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.oe(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.ce(e,s)))}addTargetData(e,t){return this.ae(e,t).next(()=>this.oe(e).next(r=>(r.targetCount+=1,this.ue(t,r),this.ce(e,r))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>dn(e).delete(t.targetId)).next(()=>this.oe(e)).next(r=>(b(r.targetCount>0),r.targetCount-=1,this.ce(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return dn(e).jt((o,a)=>{const u=cr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>y.waitFor(i)).next(()=>s)}forEachTarget(e,t){return dn(e).jt((r,s)=>{const i=cr(s);t(i)})}oe(e){return Nl(e).get(De.key).next(t=>(b(null!==t),t))}ce(e,t){return Nl(e).put(De.key,t)}ae(e,t){return dn(e).put(El(this.k,t))}ue(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.oe(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Wn(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return dn(e).jt({range:s,index:Ee.queryTargetsIndexName},(o,a,u)=>{const c=cr(a);ts(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ct(e);return t.forEach(o=>{const a=Me(o.path);s.push(i.put(new le(r,a))),s.push(this.referenceDelegate.addReference(e,r,o))}),y.waitFor(s)}removeMatchingKeys(e,t,r){const s=ct(e);return y.forEach(t,i=>{const o=Me(i.path);return y.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ct(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ct(e);let i=O();return s.jt({range:r,Kt:!0},(o,a,u)=>{const c=He(o[1]),h=new I(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Me(t.path),s=IDBKeyRange.bound([r],[pc(r)],!1,!0);let i=0;return ct(e).jt({index:le.documentTargetsIndex,Kt:!0,range:s},([o,a],u,c)=>{0!==o&&(i++,c.done())}).next(()=>i>0)}Et(e,t){return dn(e).get(t).next(r=>r?cr(r):null)}}function dn(n){return Ie(n,Ee.store)}function Nl(n){return Ie(n,De.store)}function ct(n){return Ie(n,le.store)}function Rt(n){return no.apply(this,arguments)}function no(){return no=(0,p.Z)(function*(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==pl)throw n;_("LocalStore","Unexpectedly lost primary lease")}),no.apply(this,arguments)}function kl([n,e],[t,r]){const s=k(n,t);return 0===s?k(e,r):s}class Zm{constructor(e){this.he=e,this.buffer=new j(kl),this.le=0}fe(){return++this.le}de(e){const t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();kl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Km{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.we=!1,this._e=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(e){var t=this;const r=this.we?3e5:6e4;_("LruGarbageCollector",`Garbage collection scheduled in ${r}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,(0,p.Z)(function*(){t._e=null,t.we=!0;try{yield e.collectGarbage(t.garbageCollector)}catch(s){Dt(s)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s):yield Rt(s)}yield t.me(e)}))}}class Gm{constructor(e,t){this.ge=e,this.params=t}calculateTargetCount(e,t){return this.ge.ye(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return y.resolve(Ae.I);const r=new Zm(t);return this.ge.forEachTarget(e,s=>r.de(s.sequenceNumber)).next(()=>this.ge.pe(e,s=>r.de(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.ge.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.ge.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector","Garbage collection skipped; disabled"),y.resolve(bl)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),bl):this.Te(e,t))}getCacheSize(e){return this.ge.getCacheSize(e)}Te(e,t){let r,s,i,o,a,u,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),s=this.params.maximumSequenceNumbersToCollect):s=d,o=Date.now(),this.nthSequenceNumber(e,s))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(i=d,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(c=Date.now(),Ri()<=yt.in.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-h}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${d} documents in `+(c-u)+`ms\nTotal Duration: ${c-h}ms`),y.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:d})))}}class $m{constructor(e,t){this.db=e,this.garbageCollector=new Gm(this,t)}ye(e){const t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}Ee(e){let t=0;return this.pe(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pe(e,t){return this.Ie(e,(r,s)=>t(s))}addReference(e,t,r){return ps(e,r)}removeReference(e,t,r){return ps(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ps(e,t)}Ae(e,t){return function(r,s){let i=!1;return Dl(r).Qt(o=>Cl(r,o,s).next(a=>(a&&(i=!0),y.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ie(e,(o,a)=>{if(a<=t){const u=this.Ae(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o),ct(e).delete([0,Me(o.path)])))});s.push(u)}}).next(()=>y.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ps(e,t)}Ie(e,t){const r=ct(e);let s,i=Ae.I;return r.jt({index:le.documentTargetsIndex},([o,a],{path:u,sequenceNumber:c})=>{0===o?(i!==Ae.I&&t(new I(He(s)),i),i=c,s=u):i=Ae.I}).next(()=>{i!==Ae.I&&t(new I(He(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ps(n,e){return ct(n).put((r=n.currentSequenceNumber,new le(0,Me(e.path),r)));var r}class fn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0!==s){for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t])}else this.inner[r]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),!0;return!1}forEach(e){It(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return yc(this.inner)}}class Rl{constructor(){this.changes=new fn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:D.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:V.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?y.resolve(r.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zm{constructor(e,t){this.k=e,this.Jt=t}addEntry(e,t,r){return lt(e).put(gs(t),r)}removeEntry(e,t){const r=lt(e),s=gs(t);return r.delete(s)}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Re(e,r)))}getEntry(e,t){return lt(e).get(gs(t)).next(r=>this.be(t,r))}Pe(e,t){return lt(e).get(gs(t)).next(r=>({document:this.be(t,r),size:ms(r)}))}getEntries(e,t){let r=Le();return this.ve(e,t,(s,i)=>{const o=this.be(s,i);r=r.insert(s,o)}).next(()=>r)}Ve(e,t){let r=Le(),s=new Y(I.comparator);return this.ve(e,t,(i,o)=>{const a=this.be(i,o);r=r.insert(i,a),s=s.insert(i,ms(o))}).next(()=>({documents:r,Se:s}))}ve(e,t,r){if(t.isEmpty())return y.resolve();const s=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let o=i.getNext();return lt(e).jt({range:s},(a,u,c)=>{const h=I.fromSegments(a);for(;o&&I.comparator(o,h)<0;)r(o,null),o=i.getNext();o&&o.isEqual(h)&&(r(o,u),o=i.hasNext()?i.getNext():null),o?c.Lt(o.path.toArray()):c.done()}).next(()=>{for(;o;)r(o,null),o=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,r){let s=Le();const i=t.path.length+1,o={};if(r.isEqual(D.min())){const a=t.path.toArray();o.range=IDBKeyRange.lowerBound(a)}else{const a=t.path.toArray(),u=Ji(r);o.range=IDBKeyRange.lowerBound([a,u],!0),o.index=Z.collectionReadTimeIndex}return lt(e).jt(o,(a,u,c)=>{if(a.length!==i)return;const h=Yi(this.k,u);t.path.isPrefixOf(h.key.path)?Xn(t,h)&&(s=s.insert(h.key,h)):c.done()}).next(()=>s)}newChangeBuffer(e){return new Qm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Ll(e).get(Ve.key).next(t=>(b(!!t),t))}Re(e,t){return Ll(e).put(Ve.key,t)}be(e,t){if(t){const r=Yi(this.k,t);if(!r.isNoDocument()||!r.version.isEqual(D.min()))return r}return V.newInvalidDocument(e)}}class Qm extends Rl{constructor(e,t){super(),this.De=e,this.trackRemovals=t,this.Ce=new fn(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new j((i,o)=>k(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Ce.get(i);if(o.document.isValidDocument()){const u=_l(this.De.k,o.document,this.getReadTime(i));s=s.add(i.path.popLast()),r+=ms(u)-a,t.push(this.De.addEntry(e,i,u))}else if(r-=a,this.trackRemovals){const u=_l(this.De.k,V.newNoDocument(i,D.min()),this.getReadTime(i));t.push(this.De.addEntry(e,i,u))}else t.push(this.De.removeEntry(e,i))}),s.forEach(i=>{t.push(this.De.Jt.addToCollectionParentIndex(e,i))}),t.push(this.De.updateMetadata(e,r)),y.waitFor(t)}getFromCache(e,t){return this.De.Pe(e,t).next(r=>(this.Ce.set(t,r.size),r.document))}getAllFromCache(e,t){return this.De.Ve(e,t).next(({documents:r,Se:s})=>(s.forEach((i,o)=>{this.Ce.set(i,o)}),r))}}function Ll(n){return Ie(n,Ve.store)}function lt(n){return Ie(n,Z.store)}function gs(n){return n.path.toArray()}class Hm{constructor(e){this.k=e}Nt(e,t,r,s){b(r<s&&r>=0&&s<=11);const i=new fs("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore(Ce.store),(a=e).createObjectStore(ot.store,{keyPath:ot.keyPath}),a.createObjectStore(P.store,{keyPath:P.keyPath,autoIncrement:!0}).createIndex(P.userMutationsIndex,P.userMutationsKeyPath,{unique:!0}),a.createObjectStore(fe.store),Fl(e),function(a){a.createObjectStore(Z.store)}(e));let o=y.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore(le.store),a.deleteObjectStore(Ee.store),a.deleteObjectStore(De.store)}(e),Fl(e)),o=o.next(()=>function(a){const u=a.store(De.store),c=new De(0,0,D.min().toTimestamp(),0);return u.put(De.key,c)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store(P.store).Bt().next(c=>{a.deleteObjectStore(P.store),a.createObjectStore(P.store,{keyPath:P.keyPath,autoIncrement:!0}).createIndex(P.userMutationsIndex,P.userMutationsKeyPath,{unique:!0});const h=u.store(P.store),d=c.map(f=>h.put(f));return y.waitFor(d)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore(We.store,{keyPath:We.keyPath})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Ne(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore(Ve.store)}(e),this.ke(i)))),r<7&&s>=7&&(o=o.next(()=>this.xe(i))),r<8&&s>=8&&(o=o.next(()=>this.$e(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e),function(a){const u=a.objectStore(Z.store);u.createIndex(Z.readTimeIndex,Z.readTimeIndexPath,{unique:!1}),u.createIndex(Z.collectionReadTimeIndex,Z.collectionReadTimeIndexPath,{unique:!1})}(t)})),r<10&&s>=10&&(o=o.next(()=>this.Oe(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore(on.store,{keyPath:on.keyPath})})(e),function(a){a.createObjectStore(an.store,{keyPath:an.keyPath})}(e)})),o}ke(e){let t=0;return e.store(Z.store).jt((r,s)=>{t+=ms(s)}).next(()=>{const r=new Ve(t);return e.store(Ve.store).put(Ve.key,r)})}Ne(e){const t=e.store(ot.store),r=e.store(P.store);return t.Bt().next(s=>y.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.Bt(P.userMutationsIndex,o).next(a=>y.forEach(a,u=>{b(u.userId===i.userId);const c=ln(this.k,u);return Al(e,i.userId,c).next(()=>{})}))}))}xe(e){const t=e.store(le.store),r=e.store(Z.store);return e.store(De.store).get(De.key).next(s=>{const i=[];return r.jt((o,a)=>{const u=new M(o),c=[0,Me(u)];i.push(t.get(c).next(h=>h?y.resolve():t.put(new le(0,Me(u),s.highestListenSequenceNumber))))}).next(()=>y.waitFor(i))})}$e(e,t){e.createObjectStore(Ct.store,{keyPath:Ct.keyPath});const r=t.store(Ct.store),s=new eo,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Me(u)})}};return t.store(Z.store).jt({Kt:!0},(o,a)=>{const u=new M(o);return i(u.popLast())}).next(()=>t.store(fe.store).jt({Kt:!0},([o,a,u],c)=>{const h=He(a);return i(h.popLast())}))}Oe(e){const t=e.store(Ee.store);return t.jt((r,s)=>{const i=cr(s),o=El(this.k,i);return t.put(o)})}}function Fl(n){n.createObjectStore(le.store,{keyPath:le.keyPath}).createIndex(le.documentTargetsIndex,le.documentTargetsKeyPath,{unique:!0}),n.createObjectStore(Ee.store,{keyPath:Ee.keyPath}).createIndex(Ee.queryTargetsIndexName,Ee.queryTargetsKeyPath,{unique:!0}),n.createObjectStore(De.store)}const ro="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class so{constructor(e,t,r,s,i,o,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Me=i,this.window=o,this.document=a,this.Fe=c,this.Le=h,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=d=>Promise.resolve(),!so.Pt())throw new v(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new $m(this,s),this.Ge=t+"main",this.k=new wl(u),this.ze=new Oe(this.Ge,11,new Hm(this.k)),this.He=new jm(this.referenceDelegate,this.k),this.Jt=new Bm,this.Je=new zm(this.k,this.Jt),this.Ye=new Um,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===h&&G("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new v(m.FAILED_PRECONDITION,ro);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.He.getHighestSequenceNumber(e))}).then(e=>{this.Be=new Ae(e,this.Fe)}).then(()=>{this.Ue=!0}).catch(e=>(this.ze&&this.ze.close(),Promise.reject(e)))}sn(e){var t=this;return this.We=function(){var r=(0,p.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ze.xt(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Me.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.Ze())})))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ys(e).put(new We(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.rn(e).next(t=>{t||(this.isPrimary=!1,this.Me.enqueueRetryable(()=>this.We(!1)))})}).next(()=>this.on(e)).next(t=>this.isPrimary&&!t?this.cn(e).next(()=>!1):!!t&&this.an(e).next(()=>!0))).catch(e=>{if(Dt(e))return _("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Me.enqueueRetryable(()=>this.We(e)),this.isPrimary=e})}rn(e){return lr(e).get(Ce.key).next(t=>y.resolve(this.un(t)))}hn(e){return ys(e).delete(this.clientId)}ln(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.fn(e.Qe,18e5)){e.Qe=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=Ie(r,We.store);return s.Bt().next(i=>{const o=e.dn(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return y.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Xe)for(const r of t)e.Xe.removeItem(e.wn(r.clientId))}})()}nn(){this.je=this.Me.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ze().then(()=>this.ln()).then(()=>this.nn()))}un(e){return!!e&&e.ownerId===this.clientId}on(e){return this.Le?y.resolve(!0):lr(e).get(Ce.key).next(t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)){if(this.un(t)&&this.networkEnabled)return!0;if(!this.un(t)){if(!t.allowTabSynchronization)throw new v(m.FAILED_PRECONDITION,ro);return!1}}return!(!this.networkEnabled||!this.inForeground)||ys(e).Bt().next(r=>void 0===this.dn(r,5e3).find(s=>{if(this.clientId!==s.clientId){const o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(!this.networkEnabled&&s.networkEnabled||o&&a)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&_("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.Ue=!1,e.mn(),e.je&&(e.je.cancel(),e.je=null),e.gn(),e.yn(),yield e.ze.runTransaction("shutdown","readwrite",[Ce.store,We.store],t=>{const r=new vl(t,Ae.I);return e.cn(r).next(()=>e.hn(r))}),e.ze.close(),e.pn()})()}dn(e,t){return e.filter(r=>this.fn(r.updateTimeMs,t)&&!this._n(r.clientId))}Tn(){return this.runTransaction("getActiveClients","readonly",e=>ys(e).Bt().next(t=>this.dn(t,18e5).map(r=>r.clientId)))}get started(){return this.Ue}getMutationQueue(e){return to.Xt(e,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,t,r){let i;return _("IndexedDbPersistence","Starting transaction:",e),this.ze.runTransaction(e,"readonly"===t?"readonly":"readwrite",Om,o=>(i=new vl(o,this.Be?this.Be.next():Ae.I),"readwrite-primary"===t?this.rn(i).next(a=>!!a||this.on(i)).next(a=>{if(!a)throw G(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Me.enqueueRetryable(()=>this.We(!1)),new v(m.FAILED_PRECONDITION,pl);return r(i)}).next(a=>this.an(i).next(()=>a)):this.En(i).next(()=>r(i)))).then(o=>(i.raiseOnCommittedEvent(),o))}En(e){return lr(e).get(Ce.key).next(t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)&&!this.un(t)&&!(this.Le||this.allowTabSynchronization&&t.allowTabSynchronization))throw new v(m.FAILED_PRECONDITION,ro)})}an(e){const t=new Ce(this.clientId,this.allowTabSynchronization,Date.now());return lr(e).put(Ce.key,t)}static Pt(){return Oe.Pt()}cn(e){const t=lr(e);return t.get(Ce.key).next(r=>this.un(r)?(_("IndexedDbPersistence","Releasing primary lease."),t.delete(Ce.key)):y.resolve())}fn(e,t){const r=Date.now();return!(e<r-t||e>r&&(G(`Detected an update time that is in the future: ${e} > ${r}`),1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=()=>{this.Me.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze()))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=()=>{this.mn(),(0,F.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Me.enterRestrictedMode(!0),this.Me.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(e){var t;try{const r=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return _("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return G("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(e){G("Failed to set zombie client id.",e)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(e){}}wn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function lr(n){return Ie(n,Ce.store)}function ys(n){return Ie(n,We.store)}function io(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Wm{constructor(e,t){this.progress=e,this.In=t}}class Ml{constructor(e,t,r){this.Je=e,this.An=t,this.Jt=r}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next(r=>this.bn(e,t,r))}bn(e,t,r){return this.Je.getEntry(e,t).next(s=>{for(const i of r)i.applyToLocalView(s);return s})}Pn(e,t){e.forEach((r,s)=>{for(const i of t)i.applyToLocalView(s)})}vn(e,t){return this.Je.getEntries(e,t).next(r=>this.Vn(e,r).next(()=>r))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next(r=>this.Pn(t,r))}getDocumentsMatchingQuery(e,t,r){return I.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.Sn(e,t.path):Bi(t)?this.Dn(e,t,r):this.Cn(e,t,r);var s}Sn(e,t){return this.Rn(e,new I(t)).next(r=>{let s=Gi();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}Dn(e,t,r){const s=t.collectionGroup;let i=Gi();return this.Jt.getCollectionParents(e,s).next(o=>y.forEach(o,a=>{const u=(c=t,h=a.child(s),new Qe(h,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,h;return this.Cn(e,u,r).next(c=>{c.forEach((h,d)=>{i=i.insert(h,d)})})}).next(()=>i))}Cn(e,t,r){let s,i;return this.Je.getDocumentsMatchingQuery(e,t,r).next(o=>(s=o,this.An.getAllMutationBatchesAffectingQuery(e,t))).next(o=>(i=o,this.Nn(e,i,s).next(a=>{s=a;for(const u of i)for(const c of u.mutations){const h=c.key;let d=s.get(h);null==d&&(d=V.newInvalidDocument(h),s=s.insert(h,d)),Zi(c,d,u.localWriteTime),d.isFoundDocument()||(s=s.remove(h))}}))).next(()=>(s.forEach((o,a)=>{Xn(t,a)||(s=s.remove(o))}),s))}Nn(e,t,r){let s=O();for(const o of t)for(const a of o.mutations)a instanceof it&&null===r.get(a.key)&&(s=s.add(a.key));let i=r;return this.Je.getEntries(e,s).next(o=>(o.forEach((a,u)=>{u.isFoundDocument()&&(i=i.insert(a,u))}),i))}}class oo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.kn=r,this.xn=s}static $n(e,t){let r=O(),s=O();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new oo(e,t.fromCache,r,s)}}class Ol{On(e){this.Mn=e}getDocumentsMatchingQuery(e,t,r,s){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||r.isEqual(D.min())?this.Fn(e,t):this.Mn.vn(e,s).next(i=>{const o=this.Ln(t,i);return(ss(t)||is(t))&&this.Bn(t.limitType,o,s,r)?this.Fn(e,t):(Ri()<=yt.in.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ji(t)),this.Mn.getDocumentsMatchingQuery(e,t,r).next(a=>(o.forEach(u=>{a=a.insert(u.key,u)}),a)))});var i}Ln(e,t){let r=new j(kc(e));return t.forEach((s,i)=>{Xn(e,i)&&(r=r.add(i))}),r}Bn(e,t,r,s){if(r.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Fn(e,t){return Ri()<=yt.in.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",ji(t)),this.Mn.getDocumentsMatchingQuery(e,t,D.min())}}class Ym{constructor(e,t,r,s){this.persistence=e,this.Un=t,this.k=s,this.qn=new Y(k),this.Kn=new fn(i=>Wn(i),ts),this.jn=D.min(),this.An=e.getMutationQueue(r),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new Ml(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qn))}}function Pl(n,e,t,r){return new Ym(n,e,t,r)}function ql(n,e){return ao.apply(this,arguments)}function ao(){return ao=(0,p.Z)(function*(n,e){const t=T(n);let r=t.An,s=t.Wn;const i=yield t.persistence.runTransaction("Handle user change","readonly",o=>{let a;return t.An.getAllMutationBatches(o).next(u=>(a=u,r=t.persistence.getMutationQueue(e),s=new Ml(t.Qn,r,t.persistence.getIndexManager()),r.getAllMutationBatches(o))).next(u=>{const c=[],h=[];let d=O();for(const f of a){c.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}for(const f of u){h.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}return s.vn(o,d).next(f=>({Gn:f,removedBatchIds:c,addedBatchIds:h}))})});return t.An=r,t.Wn=s,t.Un.On(t.Wn),i}),ao.apply(this,arguments)}function Jm(n,e){const t=T(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Qn.newChangeBuffer({trackRemovals:!0});return function(o,a,u,c){const h=u.batch,d=h.keys();let f=y.resolve();return d.forEach(g=>{f=f.next(()=>c.getEntry(a,g)).next(w=>{const S=u.docVersions.get(g);b(null!==S),w.version.compareTo(S)<0&&(h.applyToRemoteDocument(w,u),w.isValidDocument()&&c.addEntry(w,u.commitVersion))})}),f.next(()=>o.An.removeMutationBatch(a,h))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.An.performConsistencyCheck(r)).next(()=>t.Wn.vn(r,s))})}function Ul(n){const e=T(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.He.getLastRemoteSnapshotVersion(t))}function Xm(n,e){const t=T(n),r=e.snapshotVersion;let s=t.qn;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Qn.newChangeBuffer({trackRemovals:!0});s=t.qn;const a=[];e.targetChanges.forEach((c,h)=>{const d=s.get(h);if(!d)return;a.push(t.He.removeMatchingKeys(i,c.removedDocuments,h).next(()=>t.He.addMatchingKeys(i,c.addedDocuments,h)));let f=d.withSequenceNumber(i.currentSequenceNumber);var g,w,S;e.targetMismatches.has(h)?f=f.withResumeToken(W.EMPTY_BYTE_STRING,D.min()).withLastLimboFreeSnapshotVersion(D.min()):c.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(c.resumeToken,r)),s=s.insert(h,f),w=f,S=c,(0===(g=d).resumeToken.approximateByteSize()||w.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8||S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0)&&a.push(t.He.updateTargetData(i,f))});let u=Le();if(e.documentUpdates.forEach((c,h)=>{e.resolvedLimboDocuments.has(c)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,c))}),a.push(Vl(i,o,e.documentUpdates,r,void 0).next(c=>{u=c})),!r.isEqual(D.min())){const c=t.He.getLastRemoteSnapshotVersion(i).next(h=>t.He.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(c)}return y.waitFor(a).next(()=>o.apply(i)).next(()=>t.Wn.Vn(i,u)).next(()=>u)}).then(i=>(t.qn=s,i))}function Vl(n,e,t,r,s){let i=O();return t.forEach(o=>i=i.add(o)),e.getEntries(n,i).next(o=>{let a=Le();return t.forEach((u,c)=>{const h=o.get(u),d=(null==s?void 0:s.get(u))||r;c.isNoDocument()&&c.version.isEqual(D.min())?(e.removeEntry(u,d),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c,d),a=a.insert(u,c)):_("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),a})}function ep(n,e){const t=T(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.An.getNextMutationBatchAfterBatchId(r,e)))}function mn(n,e){const t=T(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.He.getTargetData(r,e).next(i=>i?(s=i,y.resolve(s)):t.He.allocateTargetId(r).next(o=>(s=new at(e,o,0,r.currentSequenceNumber),t.He.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.qn.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.qn=t.qn.insert(r.targetId,r),t.Kn.set(e,r.targetId)),r})}function pn(n,e,t){return uo.apply(this,arguments)}function uo(){return uo=(0,p.Z)(function*(n,e,t){const r=T(n),s=r.qn.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Dt(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.qn=r.qn.remove(e),r.Kn.delete(s.target)}),uo.apply(this,arguments)}function vs(n,e,t){const r=T(n);let s=D.min(),i=O();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,c){const h=T(a),d=h.Kn.get(c);return void 0!==d?y.resolve(h.qn.get(d)):h.He.getTargetData(u,c)}(r,o,Re(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Un.getDocumentsMatchingQuery(o,e,t?s:D.min(),t?i:O())).next(a=>({documents:a,zn:i})))}function Bl(n,e){const t=T(n),r=T(t.He),s=t.qn.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.Et(i,e).next(o=>o?o.target:null))}function jl(n){const e=T(n);return e.persistence.runTransaction("Get new document changes","readonly",t=>function(r,s,i){const o=T(r);let a=Le(),u=Ji(i);const c=lt(s),h=IDBKeyRange.lowerBound(u,!0);return c.jt({index:Z.readTimeIndex,range:h},(d,f)=>{const g=Yi(o.k,f);a=a.insert(g.key,g),u=f.readTime}).next(()=>({In:a,readTime:Tl(u)}))}(e.Qn,t,e.jn)).then(({In:t,readTime:r})=>(e.jn=r,t))}function co(){return co=(0,p.Z)(function*(n){const e=T(n);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(r){const s=lt(r);let i=D.min();return s.jt({index:Z.readTimeIndex,reverse:!0},(o,a,u)=>{a.readTime&&(i=Tl(a.readTime)),u.done()}).next(()=>i)}(t)).then(t=>{e.jn=t})}),co.apply(this,arguments)}function lo(){return lo=(0,p.Z)(function*(n,e,t,r){const s=T(n);let i=O(),o=Le(),a=Qc();for(const h of t){const d=e.Hn(h.metadata.name);h.document&&(i=i.add(d)),o=o.insert(d,e.Jn(h)),a=a.insert(d,e.Yn(h.metadata.readTime))}const u=s.Qn.newChangeBuffer({trackRemovals:!0}),c=yield mn(s,(h=r,Re(Xt(M.fromString(`__bundle__/docs/${h}`)))));var h;return s.persistence.runTransaction("Apply bundle documents","readwrite",h=>Vl(h,u,o,D.min(),a).next(d=>(u.apply(h),d)).next(d=>s.He.removeMatchingKeysForTargetId(h,c.targetId).next(()=>s.He.addMatchingKeys(h,i,c.targetId)).next(()=>s.Wn.Vn(h,d)).next(()=>d)))}),lo.apply(this,arguments)}function rp(n,e){return ho.apply(this,arguments)}function ho(){return ho=(0,p.Z)(function*(n,e,t=O()){const r=yield mn(n,Re(Xi(e.bundledQuery))),s=T(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=ne(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ye.saveNamedQuery(i,e);const a=r.withResumeToken(W.EMPTY_BYTE_STRING,o);return s.qn=s.qn.insert(a.targetId,a),s.He.updateTargetData(i,a).next(()=>s.He.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.He.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ye.saveNamedQuery(i,e))})}),ho.apply(this,arguments)}class sp{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return y.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var r;return this.Xn.set(t.id,{id:(r=t).id,version:r.version,createTime:ne(r.createTime)}),y.resolve()}getNamedQuery(e,t){return y.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,{name:(r=t).name,query:Xi(r.bundledQuery),readTime:ne(r.readTime)}),y.resolve();var r}}class fo{constructor(){this.ts=new j(re.es),this.ns=new j(re.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const r=new re(e,t);this.ts=this.ts.add(r),this.ns=this.ns.add(r)}rs(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.os(new re(e,t))}cs(e,t){e.forEach(r=>this.removeReference(r,t))}us(e){const t=new I(new M([])),r=new re(t,e),s=new re(t,e+1),i=[];return this.ns.forEachInRange([r,s],o=>{this.os(o),i.push(o.key)}),i}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new I(new M([])),r=new re(t,e),s=new re(t,e+1);let i=O();return this.ns.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new re(e,0),r=this.ts.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class re{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return I.comparator(e.key,t.key)||k(e.fs,t.fs)}static ss(e,t){return k(e.fs,t.fs)||I.comparator(e.key,t.key)}}class ip{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new j(re.es)}checkEmpty(e){return y.resolve(0===this.An.length)}addMutationBatch(e,t,r,s){const i=this.ds;this.ds++;const o=new Hi(i,t,r,s);this.An.push(o);for(const a of s)this.ws=this.ws.add(new re(a.key,i)),this.Jt.addToCollectionParentIndex(e,a.key.path.popLast());return y.resolve(o)}lookupMutationBatch(e,t){return y.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.gs(t+1),i=s<0?0:s;return y.resolve(this.An.length>i?this.An[i]:null)}getHighestUnacknowledgedBatchId(){return y.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return y.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new re(t,0),s=new re(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([r,s],o=>{const a=this._s(o.fs);i.push(a)}),y.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new j(k);return t.forEach(s=>{const i=new re(s,0),o=new re(s,Number.POSITIVE_INFINITY);this.ws.forEachInRange([i,o],a=>{r=r.add(a.fs)})}),y.resolve(this.ys(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;I.isDocumentKey(i)||(i=i.child(""));const o=new re(new I(i),0);let a=new j(k);return this.ws.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.fs)),!0)},o),y.resolve(this.ys(a))}ys(e){const t=[];return e.forEach(r=>{const s=this._s(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){b(0===this.ps(t.batchId,"removed")),this.An.shift();let r=this.ws;return y.forEach(t.mutations,s=>{const i=new re(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.ws=r})}ee(e){}containsKey(e,t){const r=new re(t,0),s=this.ws.firstAfterOrEqual(r);return y.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return y.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class op{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new Y(I.comparator),this.size=0}addEntry(e,t,r){const s=t.key,i=this.docs.get(s),o=i?i.size:0,a=this.Ts(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:a,readTime:r}),this.size+=a-o,this.Jt.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return y.resolve(r?r.document.mutableCopy():V.newInvalidDocument(t))}getEntries(e,t){let r=Le();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():V.newInvalidDocument(s))}),y.resolve(r)}getDocumentsMatchingQuery(e,t,r){let s=Le();const i=new I(t.path.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:u,readTime:c}}=o.getNext();if(!t.path.isPrefixOf(a.path))break;c.compareTo(r)<=0||Xn(t,u)&&(s=s.insert(u.key,u.mutableCopy()))}return y.resolve(s)}Es(e,t){return y.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ap(this)}getSize(e){return y.resolve(this.size)}}class ap extends Rl{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.document.isValidDocument()?t.push(this.De.addEntry(e,s.document,this.getReadTime(r))):this.De.removeEntry(r)}),y.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class up{constructor(e){this.persistence=e,this.Is=new fn(t=>Wn(t),ts),this.lastRemoteSnapshotVersion=D.min(),this.highestTargetId=0,this.As=0,this.Rs=new fo,this.targetCount=0,this.bs=kt.ie()}forEachTarget(e,t){return this.Is.forEach((r,s)=>t(s)),y.resolve()}getLastRemoteSnapshotVersion(e){return y.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return y.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),y.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.As&&(this.As=t),y.resolve()}ae(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new kt(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,y.resolve()}updateTargetData(e,t){return this.ae(t),y.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,y.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Is.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Is.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),y.waitFor(i).next(()=>s)}getTargetCount(e){return y.resolve(this.targetCount)}getTargetData(e,t){const r=this.Is.get(t)||null;return y.resolve(r)}addMatchingKeys(e,t,r){return this.Rs.rs(t,r),y.resolve()}removeMatchingKeys(e,t,r){this.Rs.cs(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),y.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),y.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Rs.ls(t);return y.resolve(r)}containsKey(e,t){return y.resolve(this.Rs.containsKey(t))}}class cp{constructor(e,t){this.Ps={},this.Be=new Ae(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new up(this),this.Jt=new Vm,this.Je=new op(this.Jt,r=>this.referenceDelegate.vs(r)),this.k=new wl(t),this.Ye=new sp(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new ip(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,r){_("MemoryPersistence","Starting transaction:",e);const s=new lp(this.Be.next());return this.referenceDelegate.Vs(),r(s).next(i=>this.referenceDelegate.Ss(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ds(e,t){return y.or(Object.values(this.Ps).map(r=>()=>r.containsKey(e,t)))}}class lp extends gl{constructor(e){super(),this.currentSequenceNumber=e}}class mo{constructor(e){this.persistence=e,this.Cs=new fo,this.Ns=null}static ks(e){return new mo(e)}get xs(){if(this.Ns)return this.Ns;throw x()}addReference(e,t,r){return this.Cs.addReference(r,t),this.xs.delete(r.toString()),y.resolve()}removeReference(e,t,r){return this.Cs.removeReference(r,t),this.xs.add(r.toString()),y.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),y.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach(s=>this.xs.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.xs.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return y.forEach(this.xs,r=>{const s=I.fromPath(r);return this.$s(e,s).next(i=>{i||t.removeEntry(s)})}).next(()=>(this.Ns=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(r=>{r?this.xs.delete(t.toString()):this.xs.add(t.toString())})}vs(e){return 0}$s(e,t){return y.or([()=>y.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}function Zl(n,e){return`firestore_clients_${n}_${e}`}function Kl(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function po(n,e){return`firestore_targets_${n}_${e}`}class ws{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Os(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new v(s.error.code,s.error.message))),o?new ws(e,t,s.state,i):(G("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ms(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hr{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Os(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new v(r.error.code,r.error.message))),i?new hr(e,r.state,s):(G("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Ms(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class _s{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Os(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=ls();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=wc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new _s(e,i):(G("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class go{constructor(e,t){this.clientId=e,this.onlineState=t}static Os(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new go(t.clientId,t.onlineState):(G("SharedClientState",`Failed to parse online state: ${e}`),null)}}class yo{constructor(){this.activeTargetIds=ls()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ms(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vo{constructor(e,t,r,s,i){this.window=e,this.Me=t,this.persistenceKey=r,this.Bs=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new Y(k),this.started=!1,this.js=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=Zl(this.persistenceKey,this.Bs),this.Ws=`firestore_sequence_number_${this.persistenceKey}`,this.Ks=this.Ks.insert(this.Bs,new yo),this.Gs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.zs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Hs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Js=`firestore_online_state_${this.persistenceKey}`,this.Ys=function(a){return`firestore_bundle_loaded_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}static Pt(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.Tn();for(const s of t){if(s===e.Bs)continue;const i=e.getItem(Zl(e.persistenceKey,s));if(i){const o=_s.Os(s,i);o&&(e.Ks=e.Ks.insert(o.clientId,o))}}e.Xs();const r=e.storage.getItem(e.Js);if(r){const s=e.Zs(r);s&&e.ti(s)}for(const s of e.js)e.qs(s);e.js=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(e){let t=!1;return this.Ks.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ni(e,"pending")}updateMutationState(e,t,r){this.ni(e,t,r),this.si(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(po(this.persistenceKey,e));if(r){const s=hr.Os(e,r);s&&(t=s.state)}}return this.ii.Fs(e),this.Xs(),t}removeLocalQueryTarget(e){this.ii.Ls(e),this.Xs()}isLocalQueryTarget(e){return this.ii.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(po(this.persistenceKey,e))}updateQueryState(e,t,r){this.ri(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.si(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.oi(e)}notifyBundleLoaded(){this.ci()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return _("SharedClientState","READ",e,t),t}setItem(e,t){_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}qs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(_("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Qs)return void G("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Me.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.Gs.test(r.key)){if(null==r.newValue){const s=t.ai(r.key);return t.ui(s,null)}{const s=t.hi(r.key,r.newValue);if(s)return t.ui(s.clientId,s)}}else if(t.zs.test(r.key)){if(null!==r.newValue){const s=t.li(r.key,r.newValue);if(s)return t.fi(s)}}else if(t.Hs.test(r.key)){if(null!==r.newValue){const s=t.di(r.key,r.newValue);if(s)return t.wi(s)}}else if(r.key===t.Js){if(null!==r.newValue){const s=t.Zs(r.newValue);if(s)return t.ti(s)}}else if(r.key===t.Ws){const s=function(i){let o=Ae.I;if(null!=i)try{const a=JSON.parse(i);b("number"==typeof a),o=a}catch(a){G("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==Ae.I&&t.sequenceNumberHandler(s)}else if(r.key===t.Ys)return t.syncEngine._i()}else t.js.push(r)}))}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,this.ii.Ms())}ni(e,t,r){const s=new ws(this.currentUser,e,t,r),i=Kl(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Ms())}si(e){const t=Kl(this.persistenceKey,this.currentUser,e);this.removeItem(t)}oi(e){this.storage.setItem(this.Js,JSON.stringify({clientId:this.Bs,onlineState:e}))}ri(e,t,r){const s=po(this.persistenceKey,e),i=new hr(e,t,r);this.setItem(s,i.Ms())}ci(){this.setItem(this.Ys,"value-not-used")}ai(e){const t=this.Gs.exec(e);return t?t[1]:null}hi(e,t){const r=this.ai(e);return _s.Os(r,t)}li(e,t){const r=this.zs.exec(e),s=Number(r[1]);return ws.Os(new ae(void 0!==r[2]?r[2]:null),s,t)}di(e,t){const r=this.Hs.exec(e),s=Number(r[1]);return hr.Os(s,t)}Zs(e){return go.Os(e)}fi(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.mi(e.batchId,e.state,e.error);_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}wi(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}ui(e,t){const r=t?this.Ks.insert(e,t):this.Ks.remove(e),s=this.ei(this.Ks),i=this.ei(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.yi(o,a).then(()=>{this.Ks=r})}ti(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ei(e){let t=ls();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Gl{constructor(){this.pi=new yo,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.pi.Fs(e),this.Ti[e]||"not-current"}updateQueryState(e,t,r){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new yo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class hp{Ei(e){}shutdown(){}}class $l{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}bi(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const dp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class fp{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Oi(e){this.ki(e)}Mi(e){this.xi(e)}}class mp extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,r,s,i){const o=this.Ui(e,t);_("RestConnection","Sending: ",o,r);const a={};return this.qi(a,s,i),this.Ki(e,o,a,r).then(u=>(_("RestConnection","Received: ",u),u),u=>{throw Gn("RestConnection",`${e} failed with error: `,u,"url: ",o,"request:",r),u})}ji(e,t,r,s,i){return this.Bi(e,t,r,s,i)}qi(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+zt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}Ui(e,t){return`${this.Fi}/v1/${t}:${dp[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,r,s){return new Promise((i,o)=>{const a=new Mf;a.listenOnce(Rf.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case ki.NO_ERROR:const c=a.getResponseJson();_("Connection","XHR received:",JSON.stringify(c)),i(c);break;case ki.TIMEOUT:_("Connection",'RPC "'+e+'" timed out'),o(new v(m.DEADLINE_EXCEEDED,"Request time out"));break;case ki.HTTP_ERROR:const h=a.getStatus();if(_("Connection",'RPC "'+e+'" failed with status:',h,"response text:",a.getResponseText()),h>0){const d=a.getResponseJson().error;if(d&&d.status&&d.message){const f=function(g){const w=g.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(w)>=0?w:m.UNKNOWN}(d.status);o(new v(f,d.message))}else o(new v(m.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new v(m.UNAVAILABLE,"Connection failed."));break;default:x()}}finally{_("Connection",'RPC "'+e+'" completed.')}});const u=JSON.stringify(s);a.send(t,"POST",u,r,15)})}Qi(e,t,r){const s=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Nf(),o=kf(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Ff({})),this.qi(a.initMessageHeaders,t,r),(0,F.uI)()||(0,F.b$)()||(0,F.d)()||(0,F.w1)()||(0,F.Mn)()||(0,F.ru)()||(a.httpHeadersOverwriteParam="$httpHeaders");const u=s.join("");_("Connection","Creating WebChannel: "+u,a);const c=i.createWebChannel(u,a);let h=!1,d=!1;const f=new fp({Vi:w=>{d?_("Connection","Not sending because WebChannel is closed:",w):(h||(_("Connection","Opening WebChannel transport."),c.open(),h=!0),_("Connection","WebChannel sending:",w),c.send(w))},Si:()=>c.close()}),g=(w,S,N)=>{w.listen(S,J=>{try{N(J)}catch(pe){setTimeout(()=>{throw pe},0)}})};return g(c,Yr.EventType.OPEN,()=>{d||_("Connection","WebChannel transport opened.")}),g(c,Yr.EventType.CLOSE,()=>{d||(d=!0,_("Connection","WebChannel transport closed"),f.Oi())}),g(c,Yr.EventType.ERROR,w=>{d||(d=!0,Gn("Connection","WebChannel transport errored:",w),f.Oi(new v(m.UNAVAILABLE,"The operation could not be completed")))}),g(c,Yr.EventType.MESSAGE,w=>{var S;if(!d){const N=w.data[0];b(!!N);const J=N,pe=J.error||(null===(S=J[0])||void 0===S?void 0:S.error);if(pe){_("Connection","WebChannel received error:",pe);const et=pe.status;let Ze=function(ja){const Ps=Q[ja];if(void 0!==Ps)return $c(Ps)}(et),Ke=pe.message;void 0===Ze&&(Ze=m.INTERNAL,Ke="Unknown error status: "+et+" with message "+pe.message),d=!0,f.Oi(new v(Ze,Ke)),c.close()}else _("Connection","WebChannel received:",N),f.Mi(N)}}),g(o,Lf.STAT_EVENT,w=>{w.stat===lc.PROXY?_("Connection","Detected buffering proxy"):w.stat===lc.NOPROXY&&_("Connection","Detected no buffering proxy")}),setTimeout(()=>{f.$i()},0),f}}function zl(){return"undefined"!=typeof window?window:null}function Ts(){return"undefined"!=typeof document?document:null}function dr(n){return new Tm(n,!0)}class wo{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Me=e,this.timerId=t,this.Wi=r,this.Gi=s,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),r=Math.max(0,Date.now()-this.Yi),s=Math.max(0,t-r);s>0&&_("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,s,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class Ql{constructor(e,t,r,s,i,o,a,u){this.Me=e,this.nr=r,this.sr=s,this.ir=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new wo(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}stop(){var e=this;return(0,p.Z)(function*(){e.hr()&&(yield e.close(0))})()}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}mr(){var e=this;return(0,p.Z)(function*(){if(e.lr())return e.close(0)})()}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.yr(),r.pr(),r.ur.cancel(),r.rr++,4!==e?r.ur.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(G(t.toString()),G("Using maximum backoff delay to prevent overloading the backend."),r.ur.Xi()):t&&t.code===m.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Tr(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Ni(t)})()}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.rr===t&&this.Ir(r,s)},r=>{e(()=>{const s=new v(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Ar(s)})})}Ir(e,t){const r=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di(()=>{r(()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(s=>{r(()=>this.Ar(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}dr(){var e=this;this.state=5,this.ur.Zi((0,p.Z)(function*(){e.state=0,e.start()}))}Ar(e){return _("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Me.enqueueAndForget(()=>this.rr===e?t():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pp extends Ql{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function xm(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:x(),s=e.targetChange.targetIds||[],i=function(u,c){return u.C?(b(void 0===c||"string"==typeof c),W.fromBase64String(c||"")):(b(void 0===c||c instanceof Uint8Array),W.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=void 0===u.code?m.UNKNOWN:$c(u.code);return new v(c,u.message||"")}(o);t=new Wc(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=Ue(n,r.document.name),i=ne(r.document.updateTime),o=new de({mapValue:{fields:r.document.fields}}),a=V.newFoundDocument(s,i,o);t=new hs(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e){const r=e.documentDelete,s=Ue(n,r.document),i=r.readTime?ne(r.readTime):D.min(),o=V.newNoDocument(s,i);t=new hs([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=Ue(n,r.document);t=new hs([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return x();{const r=e.filter,i=new dm(r.count||0);t=new Hc(r.targetId,i)}}var u;return t}(this.k,e),r=function(s){if(!("targetChange"in s))return D.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?D.min():i.readTime?ne(i.readTime):D.min()}(e);return this.listener.br(t,r)}Pr(e){const t={};t.database=ar(this.k),t.addTarget=function(s,i){let o;const a=i.target;return o=ns(a)?{documents:al(s,a)}:{query:ul(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=el(s,i.resumeToken):i.snapshotVersion.compareTo(D.min())>0&&(o.readTime=ir(s,i.snapshotVersion.toTimestamp())),o}(this.k,e);const r=function bm(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return x()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.gr(t)}vr(e){const t={};t.database=ar(this.k),t.removeTarget=e,this.gr(t)}}class gp extends Ql{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(b(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function Sm(n,e){return n&&n.length>0?(b(void 0!==e),n.map(t=>function(r,s){let i=ne(r.updateTime?r.updateTime:s);return i.isEqual(D.min())&&(i=ne(s)),new cm(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=ne(e.commitTime);return this.listener.Cr(r,t)}return b(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=ar(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>ds(this.k,r))};this.gr(t)}}class yp extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=r,this.k=s,this.$r=!1}Or(){if(this.$r)throw new v(m.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,r){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.ir.Bi(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(m.UNKNOWN,s.toString())})}ji(e,t,r){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.ir.ji(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(m.UNKNOWN,s.toString())})}terminate(){this.$r=!0}}class vp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Mr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(G(t),this.Lr=!1):_("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class wp{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;ht(o)&&(_("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(c){const h=T(c);h.Gr.add(4),yield gn(h),h.Jr.set("Unknown"),h.Gr.delete(4),yield fr(h)}),function(c){return u.apply(this,arguments)})(o))}))}),this.Jr=new vp(r,s)}}function fr(n){return _o.apply(this,arguments)}function _o(){return _o=(0,p.Z)(function*(n){if(ht(n))for(const e of n.zr)yield e(!0)}),_o.apply(this,arguments)}function gn(n){return To.apply(this,arguments)}function To(){return To=(0,p.Z)(function*(n){for(const e of n.zr)yield e(!1)}),To.apply(this,arguments)}function Es(n,e){const t=T(n);t.Wr.has(e.targetId)||(t.Wr.set(e.targetId,e),xo(t)?Io(t):vn(t).lr()&&Eo(t,e))}function mr(n,e){const t=T(n),r=vn(t);t.Wr.delete(e),r.lr()&&Hl(t,e),0===t.Wr.size&&(r.lr()?r._r():ht(t)&&t.Jr.set("Unknown"))}function Eo(n,e){n.Yr.X(e.targetId),vn(n).Pr(e)}function Hl(n,e){n.Yr.X(e),vn(n).vr(e)}function Io(n){n.Yr=new vm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Wr.get(e)||null}),vn(n).start(),n.Jr.Br()}function xo(n){return ht(n)&&!vn(n).hr()&&n.Wr.size>0}function ht(n){return 0===T(n).Gr.size}function Wl(n){n.Yr=void 0}function _p(n){return So.apply(this,arguments)}function So(){return So=(0,p.Z)(function*(n){n.Wr.forEach((e,t)=>{Eo(n,e)})}),So.apply(this,arguments)}function Tp(n,e){return bo.apply(this,arguments)}function bo(){return bo=(0,p.Z)(function*(n,e){Wl(n),xo(n)?(n.Jr.Kr(e),Io(n)):n.Jr.set("Unknown")}),bo.apply(this,arguments)}function Ep(n,e,t){return Ao.apply(this,arguments)}function Ao(){return Ao=(0,p.Z)(function*(n,e,t){if(n.Jr.set("Online"),e instanceof Wc&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.Wr.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.Wr.delete(a),s.Yr.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){_("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Is(n,r)}else if(e instanceof hs?n.Yr.ot(e):e instanceof Hc?n.Yr.dt(e):n.Yr.ut(e),!t.isEqual(D.min()))try{const r=yield Ul(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.Yr.gt(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const c=s.Wr.get(u);c&&s.Wr.set(u,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const u=s.Wr.get(a);if(!u)return;s.Wr.set(a,u.withResumeToken(W.EMPTY_BYTE_STRING,u.snapshotVersion)),Hl(s,a);const c=new at(u.target,a,1,u.sequenceNumber);Eo(s,c)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){_("RemoteStore","Failed to raise snapshot:",r),yield Is(n,r)}var r}),Ao.apply(this,arguments)}function Is(n,e,t){return Co.apply(this,arguments)}function Co(){return Co=(0,p.Z)(function*(n,e,t){if(!Dt(e))throw e;n.Gr.add(1),yield gn(n),n.Jr.set("Offline"),t||(t=()=>Ul(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){_("RemoteStore","Retrying IndexedDB access"),yield t(),n.Gr.delete(1),yield fr(n)}))}),Co.apply(this,arguments)}function Yl(n,e){return e().catch(t=>Is(n,t,e))}function yn(n){return Do.apply(this,arguments)}function Do(){return Do=(0,p.Z)(function*(n){const e=T(n),t=dt(e);let r=e.Qr.length>0?e.Qr[e.Qr.length-1].batchId:-1;for(;Ip(e);)try{const s=yield ep(e.localStore,r);if(null===s){0===e.Qr.length&&t._r();break}r=s.batchId,xp(e,s)}catch(s){yield Is(e,s)}Jl(e)&&Xl(e)}),Do.apply(this,arguments)}function Ip(n){return ht(n)&&n.Qr.length<10}function xp(n,e){n.Qr.push(e);const t=dt(n);t.lr()&&t.Sr&&t.Dr(e.mutations)}function Jl(n){return ht(n)&&!dt(n).hr()&&n.Qr.length>0}function Xl(n){dt(n).start()}function Sp(n){return No.apply(this,arguments)}function No(){return No=(0,p.Z)(function*(n){dt(n).kr()}),No.apply(this,arguments)}function bp(n){return ko.apply(this,arguments)}function ko(){return ko=(0,p.Z)(function*(n){const e=dt(n);for(const t of n.Qr)e.Dr(t.mutations)}),ko.apply(this,arguments)}function Ap(n,e,t){return Ro.apply(this,arguments)}function Ro(){return Ro=(0,p.Z)(function*(n,e,t){const r=n.Qr.shift(),s=Wi.from(r,e,t);yield Yl(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield yn(n)}),Ro.apply(this,arguments)}function Cp(n,e){return Lo.apply(this,arguments)}function Lo(){return Lo=(0,p.Z)(function*(n,e){var t;e&&dt(n).Sr&&(yield(t=(0,p.Z)(function*(r,s){if(Gc(i=s.code)&&i!==m.ABORTED){const o=r.Qr.shift();dt(r).wr(),yield Yl(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield yn(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),Jl(n)&&Xl(n)}),Lo.apply(this,arguments)}function eh(n,e){return Fo.apply(this,arguments)}function Fo(){return Fo=(0,p.Z)(function*(n,e){const t=T(n);t.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");const r=ht(t);t.Gr.add(3),yield gn(t),r&&t.Jr.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Gr.delete(3),yield fr(t)}),Fo.apply(this,arguments)}function Mo(n,e){return Oo.apply(this,arguments)}function Oo(){return Oo=(0,p.Z)(function*(n,e){const t=T(n);e?(t.Gr.delete(2),yield fr(t)):e||(t.Gr.add(2),yield gn(t),t.Jr.set("Unknown"))}),Oo.apply(this,arguments)}function vn(n){return n.Xr||(n.Xr=function(e,t,r){const s=T(e);return s.Or(),new pp(t,s.ir,s.authCredentials,s.appCheckCredentials,s.k,r)}(n.datastore,n.asyncQueue,{Di:_p.bind(null,n),Ni:Tp.bind(null,n),br:Ep.bind(null,n)}),n.zr.push(function(){var e=(0,p.Z)(function*(t){t?(n.Xr.wr(),xo(n)?Io(n):n.Jr.set("Unknown")):(yield n.Xr.stop(),Wl(n))});return function(t){return e.apply(this,arguments)}}())),n.Xr}function dt(n){return n.Zr||(n.Zr=function(e,t,r){const s=T(e);return s.Or(),new gp(t,s.ir,s.authCredentials,s.appCheckCredentials,s.k,r)}(n.datastore,n.asyncQueue,{Di:Sp.bind(null,n),Ni:Cp.bind(null,n),Nr:bp.bind(null,n),Cr:Ap.bind(null,n)}),n.zr.push(function(){var e=(0,p.Z)(function*(t){t?(n.Zr.wr(),yield yn(n)):(yield n.Zr.stop(),n.Qr.length>0&&(_("RemoteStore",`Stopping write stream with ${n.Qr.length} pending writes`),n.Qr=[]))});return function(t){return e.apply(this,arguments)}}())),n.Zr}class Po{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new ee,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Po(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new v(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wn(n,e){if(G("AsyncQueue",`${e}: ${n}`),Dt(n))return new v(m.UNAVAILABLE,`${e}: ${n}`);throw n}class _n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||I.comparator(t.key,r.key):(t,r)=>I.comparator(t.key,r.key),this.keyedMap=Gi(),this.sortedSet=new Y(this.comparator)}static emptySet(e){return new _n(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof _n)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new _n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class th{constructor(){this.eo=new Y(I.comparator)}track(e){const t=e.doc.key,r=this.eo.get(t);r?0!==e.type&&3===r.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==r.type?this.eo=this.eo.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.eo=this.eo.remove(t):1===e.type&&2===r.type?this.eo=this.eo.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):x():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal((t,r)=>{e.push(r)}),e}}class Tn{constructor(e,t,r,s,i,o,a,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u}static fromInitialDocuments(e,t,r,s){const i=[];return t.forEach(o=>{i.push({type:0,doc:o})}),new Tn(e,t,_n.emptySet(t),i,r,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Dp{constructor(){this.so=void 0,this.listeners=[]}}class Np{constructor(){this.queries=new fn(e=>Nc(e),Jn),this.onlineState="Unknown",this.io=new Set}}function qo(n,e){return Uo.apply(this,arguments)}function Uo(){return Uo=(0,p.Z)(function*(n,e){const t=T(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new Dp),s)try{i.so=yield t.onListen(r)}catch(o){const a=wn(o,`Initialization of query '${ji(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.ro(t.onlineState),i.so&&e.oo(i.so)&&jo(t)}),Uo.apply(this,arguments)}function Vo(n,e){return Bo.apply(this,arguments)}function Bo(){return Bo=(0,p.Z)(function*(n,e){const t=T(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)}),Bo.apply(this,arguments)}function kp(n,e){const t=T(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.oo(s)&&(r=!0);o.so=s}}r&&jo(t)}function Rp(n,e,t){const r=T(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function jo(n){n.io.forEach(e=>{e.next()})}class Zo{constructor(e,t,r){this.query=e,this.co=t,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=r||{}}oo(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new Tn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ao?this.ho(e)&&(this.co.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.co.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.ao&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){return!e.fromCache||!(this.options.wo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}ho(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}fo(e){e=Tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ao=!0,this.co.next(e)}}class Lp{constructor(e,t){this.payload=e,this.byteLength=t}_o(){return"metadata"in this.payload}}class nh{constructor(e){this.k=e}Hn(e){return Ue(this.k,e)}Jn(e){return e.metadata.exists?il(this.k,e.document,!1):V.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}Yn(e){return ne(e)}}class Fp{constructor(e,t,r){this.mo=e,this.localStore=t,this.k=r,this.queries=[],this.documents=[],this.progress=rh(e)}yo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}po(e){const t=new Map,r=new nh(this.k);for(const s of e)if(s.metadata.queries){const i=r.Hn(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||O()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function np(n,e,t,r){return lo.apply(this,arguments)}(e.localStore,new nh(e.k),e.documents,e.mo.id),r=e.po(e.documents);for(const s of e.queries)yield rp(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",new Wm(Object.assign({},e.progress),t)})()}}function rh(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class sh{constructor(e){this.key=e}}class ih{constructor(e){this.key=e}}class oh{constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=O(),this.mutatedKeys=O(),this.Ao=kc(e),this.Ro=new _n(this.Ao)}get bo(){return this.To}Po(e,t){const r=t?t.vo:new th,s=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u=ss(this.query)&&s.size===this.query.limit?s.last():null,c=is(this.query)&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,d)=>{const f=s.get(h),g=Xn(this.query,d)?d:null,w=!!f&&this.mutatedKeys.has(f.key),S=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let N=!1;f&&g?f.data.isEqual(g.data)?w!==S&&(r.track({type:3,doc:g}),N=!0):this.Vo(f,g)||(r.track({type:2,doc:g}),N=!0,(u&&this.Ao(g,u)>0||c&&this.Ao(g,c)<0)&&(a=!0)):!f&&g?(r.track({type:0,doc:g}),N=!0):f&&!g&&(r.track({type:1,doc:f}),N=!0,(u||c)&&(a=!0)),N&&(g?(o=o.add(g),i=S?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),ss(this.query)||is(this.query))for(;o.size>this.query.limit;){const h=ss(this.query)?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ro:o,vo:r,Bn:a,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort((c,h)=>function(d,f){const g=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return x()}};return g(d)-g(f)}(c.type,h.type)||this.Ao(c.doc,h.doc)),this.So(r);const o=t?this.Do():[],a=0===this.Io.size&&this.current?1:0,u=a!==this.Eo;return this.Eo=a,0!==i.length||u?{snapshot:new Tn(this.query,e.Ro,s,i,e.mutatedKeys,0===a,u,!1),Co:o}:{Co:o}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new th,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(t=>this.To=this.To.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.To=this.To.delete(t)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=O(),this.Ro.forEach(r=>{this.No(r.key)&&(this.Io=this.Io.add(r.key))});const t=[];return e.forEach(r=>{this.Io.has(r)||t.push(new ih(r))}),this.Io.forEach(r=>{e.has(r)||t.push(new sh(r))}),t}ko(e){this.To=e.zn,this.Io=O();const t=this.Po(e.documents);return this.applyChanges(t,!0)}xo(){return Tn.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class Mp{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Op{constructor(e){this.key=e,this.$o=!1}}class Pp{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Oo={},this.Mo=new fn(a=>Nc(a),Jn),this.Fo=new Map,this.Lo=new Set,this.Bo=new Y(I.comparator),this.Uo=new Map,this.qo=new fo,this.Ko={},this.jo=new Map,this.Qo=kt.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}function qp(n,e){return Ko.apply(this,arguments)}function Ko(){return Ko=(0,p.Z)(function*(n,e){const t=fa(n);let r,s;const i=t.Mo.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.xo();else{const o=yield mn(t.localStore,Re(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield Go(t,e,r,"current"===a),t.isPrimaryClient&&Es(t.remoteStore,o)}return s}),Ko.apply(this,arguments)}function Go(n,e,t,r){return $o.apply(this,arguments)}function $o(){return $o=(0,p.Z)(function*(n,e,t,r){n.Go=(h,d,f)=>{return(g=(0,p.Z)(function*(w,S,N,J){let pe=S.view.Po(N);pe.Bn&&(pe=yield vs(w.localStore,S.query,!1).then(({documents:Ke})=>S.view.Po(Ke,pe)));const et=J&&J.targetChanges.get(S.targetId),Ze=S.view.applyChanges(pe,w.isPrimaryClient,et);return na(w,S.targetId,Ze.Co),Ze.snapshot}),function(w,S,N,J){return g.apply(this,arguments)})(n,h,d,f);var g};const s=yield vs(n.localStore,e,!0),i=new oh(e,s.zn),o=i.Po(s.documents),a=sr.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),u=i.applyChanges(o,n.isPrimaryClient,a);na(n,t,u.Co);const c=new Mp(e,t,i);return n.Mo.set(e,c),n.Fo.has(t)?n.Fo.get(t).push(e):n.Fo.set(t,[e]),u.snapshot}),$o.apply(this,arguments)}function Up(n,e){return zo.apply(this,arguments)}function zo(){return zo=(0,p.Z)(function*(n,e){const t=T(n),r=t.Mo.get(e),s=t.Fo.get(r.targetId);if(s.length>1)return t.Fo.set(r.targetId,s.filter(i=>!Jn(i,e))),void t.Mo.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield pn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),mr(t.remoteStore,r.targetId),En(t,r.targetId)}).catch(Rt))):(En(t,r.targetId),yield pn(t.localStore,r.targetId,!0))}),zo.apply(this,arguments)}function Qo(){return Qo=(0,p.Z)(function*(n,e,t){const r=ma(n);try{const s=yield function(i,o){const a=T(i),u=te.now(),c=o.reduce((d,f)=>d.add(f.key),O());let h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>a.Wn.vn(d,c).next(f=>{h=f;const g=[];for(const w of o){const S=hm(w,h.get(w.key));null!=S&&g.push(new it(w.key,S,Ic(S.value.mapValue),z.exists(!0)))}return a.An.addMutationBatch(d,u,g,o)})).then(d=>(d.applyToLocalDocumentSet(h),{batchId:d.batchId,changes:h}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.Ko[i.currentUser.toKey()];u||(u=new Y(k)),u=u.insert(o,a),i.Ko[i.currentUser.toKey()]=u}(r,s.batchId,t),yield Ye(r,s.changes),yield yn(r.remoteStore)}catch(s){const i=wn(s,"Failed to persist write");t.reject(i)}}),Qo.apply(this,arguments)}function ah(n,e){return Ho.apply(this,arguments)}function Ho(){return Ho=(0,p.Z)(function*(n,e){const t=T(n);try{const r=yield Xm(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Uo.get(i);o&&(b(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.$o=!0:s.modifiedDocuments.size>0?b(o.$o):s.removedDocuments.size>0&&(b(o.$o),o.$o=!1))}),yield Ye(t,r,e)}catch(r){yield Rt(r)}}),Ho.apply(this,arguments)}function uh(n,e,t){const r=T(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.Mo.forEach((i,o)=>{const a=o.view.ro(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=T(i);a.onlineState=o;let u=!1;a.queries.forEach((c,h)=>{for(const d of h.listeners)d.ro(o)&&(u=!0)}),u&&jo(a)}(r.eventManager,e),s.length&&r.Oo.br(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Bp(n,e,t){return Wo.apply(this,arguments)}function Wo(){return Wo=(0,p.Z)(function*(n,e,t){const r=T(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Uo.get(e),i=s&&s.key;if(i){let o=new Y(I.comparator);o=o.insert(i,V.newNoDocument(i,D.min()));const a=O().add(i),u=new rr(D.min(),new Map,new j(k),o,a);yield ah(r,u),r.Bo=r.Bo.remove(i),r.Uo.delete(e),ra(r)}else yield pn(r.localStore,e,!1).then(()=>En(r,e,t)).catch(Rt)}),Wo.apply(this,arguments)}function jp(n,e){return Yo.apply(this,arguments)}function Yo(){return Yo=(0,p.Z)(function*(n,e){const t=T(n),r=e.batch.batchId;try{const s=yield Jm(t.localStore,e);ta(t,r,null),ea(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ye(t,s)}catch(s){yield Rt(s)}}),Yo.apply(this,arguments)}function Zp(n,e,t){return Jo.apply(this,arguments)}function Jo(){return Jo=(0,p.Z)(function*(n,e,t){const r=T(n);try{const s=yield function(i,o){const a=T(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return a.An.lookupMutationBatch(u,o).next(h=>(b(null!==h),c=h.keys(),a.An.removeMutationBatch(u,h))).next(()=>a.An.performConsistencyCheck(u)).next(()=>a.Wn.vn(u,c))})}(r.localStore,e);ta(r,e,t),ea(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ye(r,s)}catch(s){yield Rt(s)}}),Jo.apply(this,arguments)}function Xo(){return Xo=(0,p.Z)(function*(n,e){const t=T(n);ht(t.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=T(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.An.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.jo.get(r)||[];s.push(e),t.jo.set(r,s)}catch(r){const s=wn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}),Xo.apply(this,arguments)}function ea(n,e){(n.jo.get(e)||[]).forEach(t=>{t.resolve()}),n.jo.delete(e)}function ta(n,e,t){const r=T(n);let s=r.Ko[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ko[r.currentUser.toKey()]=s}}function En(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Fo.get(e))n.Mo.delete(r),t&&n.Oo.zo(r,t);n.Fo.delete(e),n.isPrimaryClient&&n.qo.us(e).forEach(r=>{n.qo.containsKey(r)||ch(n,r)})}function ch(n,e){n.Lo.delete(e.path.canonicalString());const t=n.Bo.get(e);null!==t&&(mr(n.remoteStore,t),n.Bo=n.Bo.remove(e),n.Uo.delete(t),ra(n))}function na(n,e,t){for(const r of t)r instanceof sh?(n.qo.addReference(r.key,e),Gp(n,r)):r instanceof ih?(_("SyncEngine","Document no longer in limbo: "+r.key),n.qo.removeReference(r.key,e),n.qo.containsKey(r.key)||ch(n,r.key)):x()}function Gp(n,e){const t=e.key,r=t.path.canonicalString();n.Bo.get(t)||n.Lo.has(r)||(_("SyncEngine","New document in limbo: "+t),n.Lo.add(r),ra(n))}function ra(n){for(;n.Lo.size>0&&n.Bo.size<n.maxConcurrentLimboResolutions;){const e=n.Lo.values().next().value;n.Lo.delete(e);const t=new I(M.fromString(e)),r=n.Qo.next();n.Uo.set(r,new Op(t)),n.Bo=n.Bo.insert(t,r),Es(n.remoteStore,new at(Re(Xt(t.path)),r,2,Ae.I))}}function Ye(n,e,t){return sa.apply(this,arguments)}function sa(){return sa=(0,p.Z)(function*(n,e,t){const r=T(n),s=[],i=[],o=[];var a;r.Mo.isEmpty()||(r.Mo.forEach((a,u)=>{o.push(r.Go(u,e,t).then(c=>{if(c){r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c.fromCache?"not-current":"current"),s.push(c);const h=oo.$n(u.targetId,c);i.push(h)}}))}),yield Promise.all(o),r.Oo.br(s),yield(a=(0,p.Z)(function*(u,c){const h=T(u);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>y.forEach(c,f=>y.forEach(f.kn,g=>h.persistence.referenceDelegate.addReference(d,f.targetId,g)).next(()=>y.forEach(f.xn,g=>h.persistence.referenceDelegate.removeReference(d,f.targetId,g)))))}catch(d){if(!Dt(d))throw d;_("LocalStore","Failed to update sequence numbers: "+d)}for(const d of c){const f=d.targetId;if(!d.fromCache){const g=h.qn.get(f),S=g.withLastLimboFreeSnapshotVersion(g.snapshotVersion);h.qn=h.qn.insert(f,S)}}}),function(u,c){return a.apply(this,arguments)})(r.localStore,i))}),sa.apply(this,arguments)}function $p(n,e){return ia.apply(this,arguments)}function ia(){return ia=(0,p.Z)(function*(n,e){const t=T(n);if(!t.currentUser.isEqual(e)){_("SyncEngine","User change. New user:",e.toKey());const r=yield ql(t.localStore,e);t.currentUser=e,(s=t).jo.forEach(o=>{o.forEach(a=>{a.reject(new v(m.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.jo.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ye(t,r.Gn)}var s}),ia.apply(this,arguments)}function zp(n,e){const t=T(n),r=t.Uo.get(e);if(r&&r.$o)return O().add(r.key);{let s=O();const i=t.Fo.get(e);if(!i)return s;for(const o of i){const a=t.Mo.get(o);s=s.unionWith(a.view.bo)}return s}}function Qp(n,e){return oa.apply(this,arguments)}function oa(){return oa=(0,p.Z)(function*(n,e){const t=T(n),r=yield vs(t.localStore,e.query,!0),s=e.view.ko(r);return t.isPrimaryClient&&na(t,e.targetId,s.Co),s}),oa.apply(this,arguments)}function Hp(n){return aa.apply(this,arguments)}function aa(){return aa=(0,p.Z)(function*(n){const e=T(n);return jl(e.localStore).then(t=>Ye(e,t))}),aa.apply(this,arguments)}function Wp(n,e,t,r){return ua.apply(this,arguments)}function ua(){return ua=(0,p.Z)(function*(n,e,t,r){const s=T(n),i=yield function(o,a){const u=T(o),c=T(u.An);return u.persistence.runTransaction("Lookup mutation documents","readonly",h=>c.Zt(h,a).next(d=>d?u.Wn.vn(h,d):y.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield yn(s.remoteStore):"acknowledged"===t||"rejected"===t?(ta(s,e,r||null),ea(s,e),a=e,T(T(s.localStore).An).ee(a)):x(),yield Ye(s,i)):_("SyncEngine","Cannot apply mutation batch with id: "+e)}),ua.apply(this,arguments)}function ca(){return ca=(0,p.Z)(function*(n,e){const t=T(n);if(fa(t),ma(t),!0===e&&!0!==t.Wo){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield lh(t,r.toArray());t.Wo=!0,yield Mo(t.remoteStore,!0);for(const i of s)Es(t.remoteStore,i)}else if(!1===e&&!1!==t.Wo){const r=[];let s=Promise.resolve();t.Fo.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(En(t,o),pn(t.localStore,o,!0))),mr(t.remoteStore,o)}),yield s,yield lh(t,r),function(i){const o=T(i);o.Uo.forEach((a,u)=>{mr(o.remoteStore,u)}),o.qo.hs(),o.Uo=new Map,o.Bo=new Y(I.comparator)}(t),t.Wo=!1,yield Mo(t.remoteStore,!1)}}),ca.apply(this,arguments)}function lh(n,e,t){return la.apply(this,arguments)}function la(){return la=(0,p.Z)(function*(n,e,t){const r=T(n),s=[],i=[];for(const o of e){let a;const u=r.Fo.get(o);if(u&&0!==u.length){a=yield mn(r.localStore,Re(u[0]));for(const c of u){const h=r.Mo.get(c),d=yield Qp(r,h);d.snapshot&&i.push(d.snapshot)}}else{const c=yield Bl(r.localStore,o);a=yield mn(r.localStore,c),yield Go(r,hh(c),o,!1)}s.push(a)}return r.Oo.br(i),s}),la.apply(this,arguments)}function hh(n){return Cc(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Jp(n){const e=T(n);return T(T(e.localStore).persistence).Tn()}function Xp(n,e,t,r){return ha.apply(this,arguments)}function ha(){return ha=(0,p.Z)(function*(n,e,t,r){const s=T(n);if(s.Wo)_("SyncEngine","Ignoring unexpected query state notification.");else if(s.Fo.has(e))switch(t){case"current":case"not-current":{const i=yield jl(s.localStore),o=rr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t);yield Ye(s,i,o);break}case"rejected":yield pn(s.localStore,e,!0),En(s,e,r);break;default:x()}}),ha.apply(this,arguments)}function eg(n,e,t){return da.apply(this,arguments)}function da(){return da=(0,p.Z)(function*(n,e,t){const r=fa(n);if(r.Wo){for(const s of e){if(r.Fo.has(s)){_("SyncEngine","Adding an already active target "+s);continue}const i=yield Bl(r.localStore,s),o=yield mn(r.localStore,i);yield Go(r,hh(i),o.targetId,!1),Es(r.remoteStore,o)}for(const s of t)r.Fo.has(s)&&(yield pn(r.localStore,s,!1).then(()=>{mr(r.remoteStore,s),En(r,s)}).catch(Rt))}}),da.apply(this,arguments)}function fa(n){const e=T(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ah.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Bp.bind(null,e),e.Oo.br=kp.bind(null,e.eventManager),e.Oo.zo=Rp.bind(null,e.eventManager),e}function ma(n){const e=T(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=jp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Zp.bind(null,e),e}class dh{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.k=dr(e.databaseInfo.databaseId),t.sharedClientState=t.Jo(e),t.persistence=t.Yo(e),yield t.persistence.start(),t.gcScheduler=t.Xo(e),t.localStore=t.Zo(e)})()}Xo(e){return null}Zo(e){return Pl(this.persistence,new Ol,e.initialUser,this.k)}Yo(e){return new cp(mo.ks,this.k)}Jo(e){return new Gl}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class fh extends dh{constructor(e,t,r){super(),this.tc=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield function tp(n){return co.apply(this,arguments)}(r.localStore),yield r.tc.initialize(r,e),yield ma(r.tc.syncEngine),yield yn(r.tc.remoteStore),yield r.persistence.sn(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()))})()}Zo(e){return Pl(this.persistence,new Ol,e.initialUser,this.k)}Xo(e){return new Km(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}Yo(e){const t=io(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?xe.withCacheSize(this.cacheSizeBytes):xe.DEFAULT;return new so(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,zl(),Ts(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(e){return new Gl}}class ng extends fh{constructor(e,t){super(e,t,!1),this.tc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const s=r.tc.syncEngine;r.sharedClientState instanceof vo&&(r.sharedClientState.syncEngine={mi:Wp.bind(null,s),gi:Xp.bind(null,s),yi:eg.bind(null,s),Tn:Jp.bind(null,s),_i:Hp.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.sn(function(){var i=(0,p.Z)(function*(o){yield function Yp(n,e){return ca.apply(this,arguments)}(r.tc.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start(r.localStore):o||r.gcScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}Jo(e){const t=zl();if(!vo.Pt(t))throw new v(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=io(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new vo(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class pa{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>uh(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=$p.bind(null,r.syncEngine),yield Mo(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Np}createDatastore(e){const t=dr(e.databaseInfo.databaseId),r=new mp(e.databaseInfo);return new yp(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>uh(this.syncEngine,a,0),o=$l.Pt()?new $l:new hp,new wp(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,c){const h=new Pp(r,s,i,o,a,u);return c&&(h.Wo=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(t){const r=T(t);_("RemoteStore","RemoteStore shutting down."),r.Gr.add(5),yield gn(r),r.Hr.shutdown(),r.Jr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function mh(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class xs{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ec(this.observer.next,e)}error(e){this.observer.error?this.ec(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}nc(){this.muted=!0}ec(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class rg{constructor(e,t){this.sc=e,this.k=t,this.metadata=new ee,this.buffer=new Uint8Array,this.ic=new TextDecoder("utf-8"),this.rc().then(r=>{r&&r._o()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.payload)}`))},r=>this.metadata.reject(r))}close(){return this.sc.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}Ho(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.rc()})()}rc(){var e=this;return(0,p.Z)(function*(){const t=yield e.oc();if(null===t)return null;const r=e.ic.decode(t),s=Number(r);isNaN(s)&&e.cc(`length string (${r}) is not valid number`);const i=yield e.ac(s);return new Lp(JSON.parse(i),t.length+s)})()}uc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}oc(){var e=this;return(0,p.Z)(function*(){for(;e.uc()<0&&!(yield e.hc()););if(0===e.buffer.length)return null;const t=e.uc();t<0&&e.cc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}ac(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.hc())&&t.cc("Reached the end of bundle when more is expected.");const r=t.ic.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}cc(e){throw this.sc.cancel(),new Error(`Invalid bundle format: ${e}`)}hc(){var e=this;return(0,p.Z)(function*(){const t=yield e.sc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class sg{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new v(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,p.Z)(function*(i,o){const a=T(i),u=ar(a.k)+"/documents",c={documents:o.map(g=>or(a.k,g))},h=yield a.ji("BatchGetDocuments",u,c),d=new Map;h.forEach(g=>{const w=function Im(n,e){return"found"in e?function(t,r){b(!!r.found);const s=Ue(t,r.found.name),i=ne(r.found.updateTime),o=new de({mapValue:{fields:r.found.fields}});return V.newFoundDocument(s,i,o)}(n,e):"missing"in e?function(t,r){b(!!r.missing),b(!!r.readTime);const s=Ue(t,r.missing),i=ne(r.readTime);return V.newNoDocument(s,i)}(n,e):x()}(a.k,g);d.set(w.key.toString(),w)});const f=[];return o.forEach(g=>{const w=d.get(g.toString());b(!!w),f.push(w)}),f}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new nr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=I.fromPath(s);e.mutations.push(new Ki(i,e.precondition(i)))}),yield(r=(0,p.Z)(function*(s,i){const o=T(s),a=ar(o.k)+"/documents",u={writes:i.map(c=>ds(o.k,c))};yield o.Bi("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw x();t=D.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new v(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?z.updateTime(t):z.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(D.min()))throw new v(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return z.updateTime(t)}return z.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ig{constructor(e,t,r,s){this.asyncQueue=e,this.datastore=t,this.updateFunction=r,this.deferred=s,this.lc=5,this.ur=new wo(this.asyncQueue,"transaction_retry")}run(){this.lc-=1,this.fc()}fc(){var e=this;this.ur.Zi((0,p.Z)(function*(){const t=new sg(e.datastore),r=e.dc(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.wc(i)}))}).catch(s=>{e.wc(s)})}))}dc(e){try{const t=this.updateFunction(e);return!xt(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}wc(e){this.lc>0&&this._c(e)?(this.lc-=1,this.asyncQueue.enqueueAndForget(()=>(this.fc(),Promise.resolve()))):this.deferred.reject(e)}_c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!Gc(t)}return!1}}class og{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ae.UNAUTHENTICATED,this.clientId=mc.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){_("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(_("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ee;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=wn(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function ph(n,e){return ga.apply(this,arguments)}function ga(){return ga=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,p.Z)(function*(i){r.isEqual(i)||(yield ql(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),ga.apply(this,arguments)}function gh(n,e){return ya.apply(this,arguments)}function ya(){return ya=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield va(n);_("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>eh(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>eh(e.remoteStore,i)),n.onlineComponents=e}),ya.apply(this,arguments)}function va(n){return wa.apply(this,arguments)}function wa(){return wa=(0,p.Z)(function*(n){return n.offlineComponents||(_("FirestoreClient","Using default OfflineComponentProvider"),yield ph(n,new dh)),n.offlineComponents}),wa.apply(this,arguments)}function Ss(n){return _a.apply(this,arguments)}function _a(){return _a=(0,p.Z)(function*(n){return n.onlineComponents||(_("FirestoreClient","Using default OnlineComponentProvider"),yield gh(n,new pa)),n.onlineComponents}),_a.apply(this,arguments)}function yh(n){return va(n).then(e=>e.persistence)}function Ta(n){return va(n).then(e=>e.localStore)}function vh(n){return Ss(n).then(e=>e.remoteStore)}function Ea(n){return Ss(n).then(e=>e.syncEngine)}function In(n){return Ia.apply(this,arguments)}function Ia(){return Ia=(0,p.Z)(function*(n){const e=yield Ss(n),t=e.eventManager;return t.onListen=qp.bind(null,e.syncEngine),t.onUnlisten=Up.bind(null,e.syncEngine),t}),Ia.apply(this,arguments)}function wh(n,e,t={}){const r=new ee;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new xs({next:d=>{i.enqueueAndForget(()=>Vo(s,h));const f=d.docs.has(o);!f&&d.fromCache?u.reject(new v(m.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&a&&"server"===a.source?u.reject(new v(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new Zo(Xt(o.path),c,{includeMetadataChanges:!0,wo:!0});return qo(s,h)}(yield In(n),n.asyncQueue,e,t,r)})),r.promise}function _h(n,e,t={}){const r=new ee;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new xs({next:d=>{i.enqueueAndForget(()=>Vo(s,h)),d.fromCache&&"server"===a.source?u.reject(new v(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new Zo(o,c,{includeMetadataChanges:!0,wo:!0});return qo(s,h)}(yield In(n),n.asyncQueue,e,t,r)})),r.promise}class pg{constructor(e,t,r,s,i,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=u}}class xn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof xn&&e.projectId===this.projectId&&e.database===this.database}}const Th=new Map;function xa(n,e,t){if(!t)throw new v(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Eh(n,e,t,r){if(!0===e&&!0===r)throw new v(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ih(n){if(!I.isDocumentKey(n))throw new v(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function xh(n){if(I.isDocumentKey(n))throw new v(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function bs(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":x()}function R(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new v(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bs(n);throw new v(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Sh(n,e){if(e<=0)throw new v(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class bh{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new v(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new v(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Eh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pr{constructor(e,t,r){this._authCredentials=t,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bh({}),this._settingsFrozen=!1,e instanceof xn?this._databaseId=e:(this._app=e,this._databaseId=function(s){if(!Object.prototype.hasOwnProperty.apply(s.options,["projectId"]))throw new v(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xn(s.options.projectId)}(e))}get app(){if(!this._app)throw new v(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new v(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bh(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new qf;switch(t.type){case"gapi":const r=t.client;return b(!("object"!=typeof r||null===r||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new jf(r,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new v(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Th.get(e);t&&(_("ComponentProvider","Removing Datastore"),Th.delete(e),t.terminate())}(this),Promise.resolve()}}class q{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Be(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new q(this.firestore,e,this._key)}}class me{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new me(this.firestore,e,this._query)}}class Be extends me{constructor(e,t,r){super(e,t,Xt(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new q(this.firestore,null,new I(e))}withConverter(e){return new Be(this.firestore,e,this._path)}}function Ah(n,e,...t){if(n=(0,F.m9)(n),xa("collection","path",e),n instanceof pr){const r=M.fromString(e,...t);return xh(r),new Be(n,null,r)}{if(!(n instanceof q||n instanceof Be))throw new v(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(M.fromString(e,...t));return xh(r),new Be(n.firestore,null,r)}}function As(n,e,...t){if(n=(0,F.m9)(n),1===arguments.length&&(e=mc.A()),xa("doc","path",e),n instanceof pr){const r=M.fromString(e,...t);return Ih(r),new q(n,null,new I(r))}{if(!(n instanceof q||n instanceof Be))throw new v(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(M.fromString(e,...t));return Ih(r),new q(n.firestore,n instanceof Be?n.converter:null,new I(r))}}function Ch(n,e){return n=(0,F.m9)(n),e=(0,F.m9)(e),(n instanceof q||n instanceof Be)&&(e instanceof q||e instanceof Be)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Dh(n,e){return n=(0,F.m9)(n),e=(0,F.m9)(e),n instanceof me&&e instanceof me&&n.firestore===e.firestore&&Jn(n._query,e._query)&&n.converter===e.converter}class vg{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new wo(this,"async_queue_retry"),this.bc=()=>{const t=Ts();t&&_("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ur.er()};const e=Ts();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pc(),this.vc(e)}enterRestrictedMode(e){if(!this.yc){this.yc=!0,this.Ac=e||!1;const t=Ts();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}}enqueue(e){if(this.Pc(),this.yc)return new Promise(()=>{});const t=new ee;return this.vc(()=>this.yc&&this.Ac?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.gc.push(e),this.Vc()))}Vc(){var e=this;return(0,p.Z)(function*(){if(0!==e.gc.length){try{yield e.gc[0](),e.gc.shift(),e.ur.reset()}catch(t){if(!Dt(t))throw t;_("AsyncQueue","Operation failed with retryable error: "+t)}e.gc.length>0&&e.ur.Zi(()=>e.Vc())}})()}vc(e){const t=this.mc.then(()=>(this.Ic=!0,e().catch(r=>{throw this.Ec=r,this.Ic=!1,G("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Ic=!1,r))));return this.mc=t,t}enqueueAfterDelay(e,t,r){this.Pc(),this.Rc.indexOf(e)>-1&&(t=0);const s=Po.createAndSchedule(this,e,t,r,i=>this.Sc(i));return this.Tc.push(s),s}Pc(){this.Ec&&x()}verifyOperationInProgress(){}Dc(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.mc,yield t}while(t!==e.mc)})()}Cc(e){for(const t of this.Tc)if(t.timerId===e)return!0;return!1}Nc(e){return this.Dc().then(()=>{this.Tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Dc()})}kc(e){this.Rc.push(e)}Sc(e){const t=this.Tc.indexOf(e);this.Tc.splice(t,1)}}function Sa(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class wg{constructor(){this._progressObserver={},this._taskCompletionResolver=new ee,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class B extends pr{constructor(e,t,r){super(e,t,r),this.type="firestore",this._queue=new vg,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Nh(this),this._firestoreClient.terminate()}}function H(n){return n._firestoreClient||Nh(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Nh(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new pg(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new og(n._authCredentials,n._appCheckCredentials,n._queue,r)}function kh(n,e,t){const r=new ee;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield ph(n,t),yield gh(n,e),r.resolve()}catch(s){if(!("FirebaseError"===(i=s).name?i.code===m.FAILED_PRECONDITION||i.code===m.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw s;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var i})).then(()=>r.promise)}function Rh(n){if(n._initialized||n._terminated)throw new v(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Je{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new v(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class je{constructor(e){this._byteString=e}static fromBase64String(e){try{return new je(W.fromBase64String(e))}catch(t){throw new v(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new je(W.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Lt{constructor(e){this._methodName=e}}class Cs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new v(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new v(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return k(this._lat,e._lat)||k(this._long,e._long)}}const Dg=/^__.*__$/;class Ng{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new it(e,this.data,this.fieldMask,t,this.fieldTransforms):new tr(e,this.data,t,this.fieldTransforms)}}class Lh{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new it(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Fh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw x()}}class Ds{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.k=r,this.ignoreUndefinedProperties=s,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(e){return new Ds(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Oc({path:r,Fc:!1});return s.Lc(e),s}Bc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Oc({path:r,Fc:!1});return s.xc(),s}Uc(e){return this.Oc({path:void 0,Fc:!0})}qc(e){return Rs(e,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lc(this.path.get(e))}Lc(e){if(0===e.length)throw this.qc("Document fields must not be empty");if(Fh(this.$c)&&Dg.test(e))throw this.qc('Document fields cannot begin and end with "__"')}}class kg{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=r||dr(e)}Qc(e,t,r,s=!1){return new Ds({$c:e,methodName:t,jc:r,path:ue.emptyPath(),Fc:!1,Kc:s},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function Ft(n){const e=n._freezeSettings(),t=dr(n._databaseId);return new kg(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ns(n,e,t,r,s,i={}){const o=n.Qc(i.merge||i.mergeFields?2:0,e,t,s);Da("Data must be an object, but it was:",o,r);const a=Ph(r,o);let u,c;if(i.merge)u=new Ht(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const d of i.mergeFields){const f=Na(e,d,t);if(!o.contains(f))throw new v(m.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);Uh(h,f)||h.push(f)}u=new Ht(h),c=o.fieldTransforms.filter(d=>u.covers(d.field))}else u=null,c=o.fieldTransforms;return new Ng(new de(a),u,c)}class gr extends Lt{_toFieldTransform(e){if(2!==e.$c)throw e.qc(1===e.$c?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof gr}}function Mh(n,e,t){return new Ds({$c:3,jc:e.settings.jc,methodName:n._methodName,Fc:t},e.databaseId,e.k,e.ignoreUndefinedProperties)}class ba extends Lt{_toFieldTransform(e){return new er(e.path,new tn)}isEqual(e){return e instanceof ba}}class Rg extends Lt{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=Mh(this,e,!0),r=this.Wc.map(i=>Mt(i,t)),s=new bt(r);return new er(e.path,s)}isEqual(e){return this===e}}class Lg extends Lt{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=Mh(this,e,!0),r=this.Wc.map(i=>Mt(i,t)),s=new At(r);return new er(e.path,s)}isEqual(e){return this===e}}class Fg extends Lt{constructor(e,t){super(e),this.Gc=t}_toFieldTransform(e){const t=new nn(e.k,Fc(e.k,this.Gc));return new er(e.path,t)}isEqual(e){return this===e}}function Aa(n,e,t,r){const s=n.Qc(1,e,t);Da("Data must be an object, but it was:",s,r);const i=[],o=de.empty();It(r,(u,c)=>{const h=ks(e,u,t);c=(0,F.m9)(c);const d=s.Bc(h);if(c instanceof gr)i.push(h);else{const f=Mt(c,d);null!=f&&(i.push(h),o.set(h,f))}});const a=new Ht(i);return new Lh(o,a,s.fieldTransforms)}function Ca(n,e,t,r,s,i){const o=n.Qc(1,e,t),a=[Na(e,r,t)],u=[s];if(i.length%2!=0)throw new v(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(Na(e,i[f])),u.push(i[f+1]);const c=[],h=de.empty();for(let f=a.length-1;f>=0;--f)if(!Uh(c,a[f])){const g=a[f];let w=u[f];w=(0,F.m9)(w);const S=o.Bc(g);if(w instanceof gr)c.push(g);else{const N=Mt(w,S);null!=N&&(c.push(g),h.set(g,N))}}const d=new Ht(c);return new Lh(h,d,o.fieldTransforms)}function Oh(n,e,t,r=!1){return Mt(t,n.Qc(r?4:3,e))}function Mt(n,e){if(qh(n=(0,F.m9)(n)))return Da("Unsupported field value:",e,n),Ph(n,e);if(n instanceof Lt)return function(t,r){if(!Fh(r.$c))throw r.qc(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.qc(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Fc&&4!==e.$c)throw e.qc("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=Mt(o,r.Uc(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,F.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Fc(r.k,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=te.fromDate(t);return{timestampValue:ir(r.k,s)}}if(t instanceof te){const s=new te(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ir(r.k,s)}}if(t instanceof Cs)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof je)return{bytesValue:el(r.k,t._byteString)};if(t instanceof q){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.qc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:$i(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.qc(`Unsupported field value: ${bs(t)}`)}(n,e)}function Ph(n,e){const t={};return yc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):It(n,(r,s)=>{const i=Mt(s,e.Mc(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function qh(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof te||n instanceof Cs||n instanceof je||n instanceof q||n instanceof Lt)}function Da(n,e,t){if(!qh(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=bs(t);throw e.qc("an object"===r?n+" a custom object":n+" "+r)}var r}function Na(n,e,t){if((e=(0,F.m9)(e))instanceof Je)return e._internalPath;if("string"==typeof e)return ks(n,e);throw Rs("Field path arguments must be of type string or ",n,!1,void 0,t)}const Mg=new RegExp("[~\\*/\\[\\]]");function ks(n,e,t){if(e.search(Mg)>=0)throw Rs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Je(...e.split("."))._internalPath}catch(r){throw Rs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rs(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new v(m.INVALID_ARGUMENT,a+n+u)}function Uh(n,e){return n.some(t=>t.isEqual(e))}class yr{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new q(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Og(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ls("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Og extends yr{data(){return super.data()}}function Ls(n,e){return"string"==typeof e?ks(n,e):e instanceof Je?e._internalPath:e._delegate._internalPath}class Ot{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Xe extends yr{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new vr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ls("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class vr extends Xe{data(e={}){return super.data(e)}}class ft{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ot(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new vr(this._firestore,this._userDataWriter,r.key,r,new Ot(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new v(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new vr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Ot(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new vr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Ot(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:Pg(o.type),doc:a,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Pg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x()}}function Vh(n,e){return n instanceof Xe&&e instanceof Xe?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ft&&e instanceof ft&&n._firestore===e._firestore&&Dh(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Bh(n){if(is(n)&&0===n.explicitOrderBy.length)throw new v(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class wr{}function mt(n,...e){for(const t of e)n=t._apply(n);return n}class qg extends wr{constructor(e,t,r){super(),this.zc=e,this.Hc=t,this.Jc=r,this.type="where"}_apply(e){const t=Ft(e.firestore),r=function(s,i,o,a,u,c,h){let d;if(u.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new v(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){zh(h,c);const g=[];for(const w of h)g.push($h(a,s,w));d={arrayValue:{values:g}}}else d=$h(a,s,h)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||zh(h,c),d=Oh(o,"where",h,"in"===c||"not-in"===c);const f=we.create(u,c,d);return function(g,w){if(w.V()){const N=Vi(g);if(null!==N&&!N.isEqual(w.field))throw new v(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${N.toString()}' and '${w.field.toString()}'`);const J=Ui(g);null!==J&&Qh(0,w.field,J)}const S=function(N,J){for(const pe of N.filters)if(J.indexOf(pe.op)>=0)return pe.op;return null}(g,function(N){switch(N){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(w.op));if(null!==S)throw new v(m.INVALID_ARGUMENT,S===w.op?`Invalid query. You cannot use more than one '${w.op.toString()}' filter.`:`Invalid query. You cannot use '${w.op.toString()}' filters with '${S.toString()}' filters.`)}(s,f),f}(e._query,0,t,e.firestore._databaseId,this.zc,this.Hc,this.Jc);return new me(e.firestore,e.converter,function(s,i){const o=s.filters.concat([i]);return new Qe(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,r))}}class Vg extends wr{constructor(e,t){super(),this.zc=e,this.Yc=t,this.type="orderBy"}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new v(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new v(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Jt(s,i);return function(a,u){if(null===Ui(a)){const c=Vi(a);null!==c&&Qh(0,c,u.field)}}(r,o),o}(e._query,this.zc,this.Yc);return new me(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new Qe(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class jh extends wr{constructor(e,t,r){super(),this.type=e,this.Xc=t,this.Zc=r}_apply(e){return new me(e.firestore,e.converter,Dc(e._query,this.Xc,this.Zc))}}class Zh extends wr{constructor(e,t,r){super(),this.type=e,this.ta=t,this.ea=r}_apply(e){const t=Gh(e,this.type,this.ta,this.ea);return new me(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class Kh extends wr{constructor(e,t,r){super(),this.type=e,this.ta=t,this.ea=r}_apply(e){const t=Gh(e,this.type,this.ta,this.ea);return new me(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function Gh(n,e,t,r){if(t[0]=(0,F.m9)(t[0]),t[0]instanceof yr)return function(s,i,o,a,u){if(!a)throw new v(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const h of en(s))if(h.field.isKeyField())c.push(Xr(i,a.key));else{const d=a.data.field(h.field);if(Fi(d))throw new v(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===d){const f=h.field.canonicalString();throw new v(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}c.push(d)}return new Yn(c,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Ft(n.firestore);return function(i,o,a,u,c,h){const d=i.explicitOrderBy;if(c.length>d.length)throw new v(m.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const f=[];for(let g=0;g<c.length;g++){const w=c[g];if(d[g].field.isKeyField()){if("string"!=typeof w)throw new v(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof w}`);if(!Bi(i)&&-1!==w.indexOf("/"))throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${w}' contains a slash.`);const S=i.path.child(M.fromString(w));if(!I.isDocumentKey(S))throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${S}' is not because it contains an odd number of segments.`);const N=new I(S);f.push(Xr(o,N))}else{const S=Oh(a,u,w);f.push(S)}}return new Yn(f,h)}(n._query,n.firestore._databaseId,s,e,t,r)}}function $h(n,e,t){if("string"==typeof(t=(0,F.m9)(t))){if(""===t)throw new v(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bi(e)&&-1!==t.indexOf("/"))throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(M.fromString(t));if(!I.isDocumentKey(r))throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Xr(n,new I(r))}if(t instanceof q)return Xr(n,t._key);throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${bs(t)}.`)}function zh(n,e){if(!Array.isArray(n)||0===n.length)throw new v(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new v(m.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Qh(n,e,t){if(!t.isEqual(e))throw new v(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class ka{convertValue(e,t="none"){switch(St(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Wt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw x()}}convertObject(e,t){const r={};return It(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Cs($(e.latitude),$(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=vc(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zn(e));default:return null}}convertTimestamp(e){const t=st(e);return new te(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=M.fromString(e);b(fl(r));const s=new xn(r.get(1),r.get(3)),i=new I(r.popFirst(5));return s.isEqual(t)||G(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Fs(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Qg extends ka{constructor(e){super(),this.firestore=e}convertBytes(e){return new je(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new q(this.firestore,null,t)}}class Hh{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ft(e)}set(e,t,r){this._verifyNotCommitted();const s=pt(e,this._firestore),i=Fs(s.converter,t,r),o=Ns(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,z.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=pt(e,this._firestore);let o;return o="string"==typeof(t=(0,F.m9)(t))||t instanceof Je?Ca(this._dataReader,"WriteBatch.update",i._key,t,r,s):Aa(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,z.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=pt(e,this._firestore);return this._mutations=this._mutations.concat(new nr(t._key,z.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new v(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function pt(n,e){if((n=(0,F.m9)(n)).firestore!==e)throw new v(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Pt extends ka{constructor(e){super(),this.firestore=e}convertBytes(e){return new je(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new q(this.firestore,null,t)}}function Wh(n,e,t){n=R(n,q);const r=R(n.firestore,B),s=Fs(n.converter,e,t);return Sn(r,[Ns(Ft(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,z.none())])}function Yh(n,e,t,...r){n=R(n,q);const s=R(n.firestore,B),i=Ft(s);let o;return o="string"==typeof(e=(0,F.m9)(e))||e instanceof Je?Ca(i,"updateDoc",n._key,e,t,r):Aa(i,"updateDoc",n._key,e),Sn(s,[o.toMutation(n._key,z.exists(!0))])}function Jh(n,...e){var t,r,s;n=(0,F.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Sa(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Sa(e[o])){const d=e[o];e[o]=null===(t=d.next)||void 0===t?void 0:t.bind(d),e[o+1]=null===(r=d.error)||void 0===r?void 0:r.bind(d),e[o+2]=null===(s=d.complete)||void 0===s?void 0:s.bind(d)}let u,c,h;if(n instanceof q)c=R(n.firestore,B),h=Xt(n._key.path),u={next:d=>{e[o]&&e[o](Ra(c,n,d))},error:e[o+1],complete:e[o+2]};else{const d=R(n,me);c=R(d.firestore,B),h=d._query;const f=new Pt(c);u={next:g=>{e[o]&&e[o](new ft(c,f,d,g))},error:e[o+1],complete:e[o+2]},Bh(n._query)}return function(d,f,g,w){const S=new xs(w),N=new Zo(f,S,g);return d.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return qo(yield In(d),N)})),()=>{S.nc(),d.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return Vo(yield In(d),N)}))}}(H(c),h,a,u)}function Sn(n,e){return function(t,r){const s=new ee;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function Vp(n,e,t){return Qo.apply(this,arguments)}(yield Ea(t),r,s)})),s.promise}(H(n),e)}function Ra(n,e,t){const r=t.docs.get(e._key),s=new Pt(n);return new Xe(n,s,e._key,r,new Ot(t.hasPendingWrites,t.fromCache),e.converter)}class sy extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ft(e)}get(e){const t=pt(e,this._firestore),r=new Qg(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return x();const i=s[0];if(i.isFoundDocument())return new yr(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new yr(this._firestore,r,t._key,null,t.converter);throw x()})}set(e,t,r){const s=pt(e,this._firestore),i=Fs(s.converter,t,r),o=Ns(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=pt(e,this._firestore);let o;return o="string"==typeof(t=(0,F.m9)(t))||t instanceof Je?Ca(this._dataReader,"Transaction.update",i._key,t,r,s):Aa(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=pt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=pt(e,this._firestore),r=new Pt(this._firestore);return super.get(e).then(s=>new Xe(this._firestore,r,t._key,s._document,new Ot(!1,!1),t.converter))}}function Fa(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new v("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function ed(){if("undefined"==typeof Uint8Array)throw new v("unimplemented","Uint8Arrays are not available in this environment.")}function td(){if(!function $f(){return"undefined"!=typeof atob}())throw new v("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){zt=Sr.SDK_VERSION,(0,Sr._registerComponent)(new Ha.wA("firestore",(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),i=new B(s,new Vf(t.getProvider("auth-internal")),new Zf(t.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i},"PUBLIC")),(0,Sr.registerVersion)(hc,"3.4.4",n),(0,Sr.registerVersion)(hc,"3.4.4","esm2017")}();class _r{constructor(e){this._delegate=e}static fromBase64String(e){return td(),new _r(je.fromBase64String(e))}static fromUint8Array(e){return ed(),new _r(je.fromUint8Array(e))}toBase64(){return td(),this._delegate.toBase64()}toUint8Array(){return ed(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ma(n){return function fy(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class my{enableIndexedDbPersistence(e,t){return function Tg(n,e){Rh(n=R(n,B));const t=H(n),r=n._freezeSettings(),s=new pa;return kh(t,s,new fh(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Eg(n){Rh(n=R(n,B));const e=H(n),t=n._freezeSettings(),r=new pa;return kh(e,r,new ng(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Ig(n){if(n._initialized&&!n._terminated)throw new v(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ee;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(r){if(!Oe.Pt())return Promise.resolve();const s=r+"main";yield Oe.delete(s)}),function(r){return t.apply(this,arguments)})(io(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class nd{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof xn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Gn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function gg(n,e,t,r={}){var s;const i=(n=R(n,pr))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Gn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=ae.MOCK_USER;else{o=(0,F.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new v(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new ae(u)}n._authCredentials=new Uf(new dc(o,a))}}(this._delegate,e,t,r)}enableNetwork(){return function Sg(n){return function ag(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield yh(n),t=yield vh(n);return e.setNetworkEnabled(!0),function(r){const s=T(r);return s.Gr.delete(0),fr(s)}(t)}))}(H(n=R(n,B)))}(this._delegate)}disableNetwork(){return function bg(n){return function ug(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield yh(n),t=yield vh(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const i=T(s);i.Gr.add(0),yield gn(i),i.Jr.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(H(n=R(n,B)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Eh("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function xg(n){return function(e){const t=new ee;return e.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function Kp(n,e){return Xo.apply(this,arguments)}(yield Ea(e),t)})),t.promise}(H(n=R(n,B)))}(this._delegate)}onSnapshotsInSync(e){return function ry(n,e){return function hg(n,e){const t=new xs(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield In(n),s=t,T(r).io.add(s),void s.next();var r,s})),()=>{t.nc(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield In(n),s=t,void T(r).io.delete(s);var r,s}))}}(H(n=R(n,B)),Sa(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new v("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new bn(this,Ah(this._delegate,e))}catch(t){throw _e(t,"collection()","Firestore.collection()")}}doc(e){try{return new Fe(this,As(this._delegate,e))}catch(t){throw _e(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Te(this,function yg(n,e){if(n=R(n,pr),xa("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new v(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new me(n,null,(t=e,new Qe(M.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw _e(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function iy(n,e){return function dg(n,e){const t=new ee;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const r=yield(s=n,Ss(s).then(i=>i.datastore));var s;new ig(n.asyncQueue,r,e,t).run()})),t.promise}(H(n=R(n,B)),t=>e(new sy(n,t)))}(this._delegate,t=>e(new rd(this,t)))}batch(){return H(this._delegate),new sd(new Hh(this._delegate,e=>Sn(this._delegate,e)))}loadBundle(e){return function Ag(n,e){const t=H(n=R(n,B)),r=new wg;return function fg(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,u=function(u,c){if(u instanceof Uint8Array)return mh(u,c);if(u instanceof ArrayBuffer)return mh(new Uint8Array(u),c);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new rg(u,o);var u}(t,dr(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function tg(n,e,t){const r=T(n);var s;(s=(0,p.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(f,g){const w=T(f),S=ne(g.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",N=>w.Ye.getBundleMetadata(N,g.id)).then(N=>!!N&&N.createTime.compareTo(S)>=0)}(i.localStore,u))return yield o.close(),void a._completeWith((f=u,{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}));a._updateProgress(rh(u));const c=new Fp(u,i.localStore,o.k);let h=yield o.Ho();for(;h;){const f=yield c.yo(h);f&&a._updateProgress(f),h=yield o.Ho()}const d=yield c.complete();yield Ye(i,d.In,void 0),yield function(f,g){const w=T(f);return w.persistence.runTransaction("Save bundle","readwrite",S=>w.Ye.saveBundleMetadata(S,g))}(i.localStore,u),a._completeWith(d.progress)}catch(u){Gn("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u)}var f}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(yield Ea(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function Cg(n,e){return function mg(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(t,r){const s=T(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Ye.getNamedQuery(i,r))}(yield Ta(n),e)}))}(H(n=R(n,B)),e).then(t=>t?new me(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Te(this,t):null)}}class Ms extends ka{constructor(e){super(),this.firestore=e}convertBytes(e){return new _r(new je(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Fe.forKey(t,this.firestore,null)}}class rd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ms(e)}get(e){const t=Ut(e);return this._delegate.get(t).then(r=>new Tr(this._firestore,new Xe(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=Ut(e);return r?(Fa("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Ut(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Ut(e);return this._delegate.delete(t),this}}class sd{constructor(e){this._delegate=e}set(e,t,r){const s=Ut(e);return r?(Fa("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Ut(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Ut(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class qt{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new vr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Er(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=qt.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new qt(e,new Ms(e),t),s.set(t,i)),i}}qt.INSTANCES=new WeakMap;class Fe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ms(e)}static forPath(e,t,r){if(e.length%2!=0)throw new v("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Fe(t,new q(t._delegate,r,new I(e)))}static forKey(e,t,r){return new Fe(t,new q(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new bn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new bn(this.firestore,Ah(this._delegate,e))}catch(t){throw _e(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,F.m9)(e))instanceof q&&Ch(this._delegate,e)}set(e,t){t=Fa("DocumentReference.set",t);try{return t?Wh(this._delegate,e,t):Wh(this._delegate,e)}catch(r){throw _e(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Yh(this._delegate,e):Yh(this._delegate,e,t,...r)}catch(s){throw _e(s,"updateDoc()","DocumentReference.update()")}}delete(){return function ty(n){return Sn(R(n.firestore,B),[new nr(n._key,z.none())])}(this._delegate)}onSnapshot(...e){const t=id(e),r=od(e,s=>new Tr(this.firestore,new Xe(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return Jh(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function Wg(n){n=R(n,q);const e=R(n.firestore,B),t=H(e),r=new Pt(e);return function cg(n,e){const t=new ee;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield function(u,c){const h=T(u);return h.persistence.runTransaction("read document","readonly",d=>h.Wn.Rn(d,c))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new v(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=wn(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Ta(n),e,t);var r})),t.promise}(t,n._key).then(s=>new Xe(e,r,n._key,s,new Ot(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function Yg(n){n=R(n,q);const e=R(n.firestore,B);return wh(H(e),n._key,{source:"server"}).then(t=>Ra(e,n,t))}(this._delegate):function Hg(n){n=R(n,q);const e=R(n.firestore,B);return wh(H(e),n._key).then(t=>Ra(e,n,t))}(this._delegate),t.then(r=>new Tr(this.firestore,new Xe(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Fe(this.firestore,this._delegate.withConverter(e?qt.getInstance(this.firestore,e):null))}}function _e(n,e,t){return n.message=n.message.replace(e,t),n}function id(n){for(const e of n)if("object"==typeof e&&!Ma(e))return e;return{}}function od(n,e){var t,r;let s;return s=Ma(n[0])?n[0]:Ma(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Tr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Fe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Vh(this._delegate,e._delegate)}}class Er extends Tr{data(e){const t=this._delegate.data(e);return function Pf(n,e){n||x()}(void 0!==t),t}}class Te{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ms(e)}where(e,t,r){try{return new Te(this.firestore,mt(this._delegate,function Ug(n,e,t){const r=e,s=Ls("where",n);return new qg(s,r,t)}(e,t,r)))}catch(s){throw _e(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Te(this.firestore,mt(this._delegate,function Bg(n,e="asc"){const t=e,r=Ls("orderBy",n);return new Vg(r,t)}(e,t)))}catch(r){throw _e(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Te(this.firestore,mt(this._delegate,function jg(n){return Sh("limit",n),new jh("limit",n,"F")}(e)))}catch(t){throw _e(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Te(this.firestore,mt(this._delegate,function Zg(n){return Sh("limitToLast",n),new jh("limitToLast",n,"L")}(e)))}catch(t){throw _e(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Te(this.firestore,mt(this._delegate,function Kg(...n){return new Zh("startAt",n,!0)}(...e)))}catch(t){throw _e(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Te(this.firestore,mt(this._delegate,function Gg(...n){return new Zh("startAfter",n,!1)}(...e)))}catch(t){throw _e(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Te(this.firestore,mt(this._delegate,function $g(...n){return new Kh("endBefore",n,!0)}(...e)))}catch(t){throw _e(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Te(this.firestore,mt(this._delegate,function zg(...n){return new Kh("endAt",n,!1)}(...e)))}catch(t){throw _e(t,"endAt()","Query.endAt()")}}isEqual(e){return Dh(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function Xg(n){n=R(n,me);const e=R(n.firestore,B),t=H(e),r=new Pt(e);return function lg(n,e){const t=new ee;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield vs(s,i,!0),u=new oh(i,a.zn),c=u.Po(a.documents),h=u.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const u=wn(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Ta(n),e,t);var r})),t.promise}(t,n._query).then(s=>new ft(e,r,n,s))}(this._delegate):"server"===(null==e?void 0:e.source)?function ey(n){n=R(n,me);const e=R(n.firestore,B),t=H(e),r=new Pt(e);return _h(t,n._query,{source:"server"}).then(s=>new ft(e,r,n,s))}(this._delegate):function Jg(n){n=R(n,me);const e=R(n.firestore,B),t=H(e),r=new Pt(e);return Bh(n._query),_h(t,n._query).then(s=>new ft(e,r,n,s))}(this._delegate),t.then(r=>new Oa(this.firestore,new ft(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=id(e),r=od(e,s=>new Oa(this.firestore,new ft(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return Jh(this._delegate,t,r)}withConverter(e){return new Te(this.firestore,this._delegate.withConverter(e?qt.getInstance(this.firestore,e):null))}}class gy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Er(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Oa{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Te(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Er(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new gy(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Er(this._firestore,r))})}isEqual(e){return Vh(this._delegate,e._delegate)}}class bn extends Te{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Fe(this.firestore,e):null}doc(e){try{return new Fe(this.firestore,void 0===e?As(this._delegate):As(this._delegate,e))}catch(t){throw _e(t,"doc()","CollectionReference.doc()")}}add(e){return function ny(n,e){const t=R(n.firestore,B),r=As(n),s=Fs(n.converter,e);return Sn(t,[Ns(Ft(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,z.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Fe(this.firestore,t))}isEqual(e){return Ch(this._delegate,e._delegate)}withConverter(e){return new bn(this.firestore,this._delegate.withConverter(e?qt.getInstance(this.firestore,e):null))}}function Ut(n){return R(n,q)}class Pa{constructor(...e){this._delegate=new Je(...e)}static documentId(){return new Pa(ue.keyField().canonicalString())}isEqual(e){return(e=(0,F.m9)(e))instanceof Je&&this._delegate._internalPath.isEqual(e._internalPath)}}class Vt{constructor(e){this._delegate=e}static serverTimestamp(){const e=function ay(){return new ba("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Vt(e)}static delete(){const e=function oy(){return new gr("deleteField")}();return e._methodName="FieldValue.delete",new Vt(e)}static arrayUnion(...e){const t=function uy(...n){return new Rg("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Vt(t)}static arrayRemove(...e){const t=function cy(...n){return new Lg("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Vt(t)}static increment(e){const t=function ly(n){return new Fg("increment",n)}(e);return t._methodName="FieldValue.increment",new Vt(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const yy={Firestore:nd,GeoPoint:Cs,Timestamp:te,Blob:_r,Transaction:rd,WriteBatch:sd,DocumentReference:Fe,DocumentSnapshot:Tr,Query:Te,QueryDocumentSnapshot:Er,QuerySnapshot:Oa,CollectionReference:bn,FieldPath:Pa,FieldValue:Vt,setLogLevel:function py(n){!function Of(n){rt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function wy(n){(function vy(n,e){n.INTERNAL.registerComponent(new Ha.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(r,s)},"PUBLIC").setServiceProps(Object.assign({},yy)))})(n,(e,t)=>new nd(e,t,new my)),n.registerVersion("@firebase/firestore-compat","0.1.13")}(Ad.Z);var gt=C(1205),_y=C(440);function ad(n,e){return function Ty(n,e=Ed.z){return new Id.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function qa(n,e){return ad(n,e).pipe((0,Pe.U)(t=>({payload:t,type:"query"})))}function Os(n,e){return qa(n,e).pipe((0,qs.O)(void 0),Us(),(0,Pe.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const u=s.find(h=>h.doc.ref.isEqual(o.ref)),c=null==t?void 0:t.payload.docs.find(h=>h.ref.isEqual(o.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(o.metadata)||!u&&c&&JSON.stringify(c.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function ud(n,e,t){return Os(n,t).pipe((0,Vs.R)((r,s)=>function Iy(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function xy(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Ua(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Ua(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Ua(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),(0,bd.x)(),(0,Pe.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function Ua(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function cd(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}C(127);class ld{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Os(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Pe.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe((0,qs.O)(void 0),Us(),(0,za.h)(([r,s])=>s.length>0||!r),(0,Pe.U)(([r,s])=>s),ke.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Vs.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=cd(e);return ud(this.query,t,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return qa(this.query,this.afs.schedulers.outsideAngular).pipe((0,Pe.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),ke.iC)}get(e){return(0,Ir.D)(this.query.get(e)).pipe(ke.iC)}add(e){return this.ref.add(e)}doc(e){return new hd(this.ref.doc(e),this.afs)}}class hd{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=dd(r,t);return new ld(s,i,this.afs)}snapshotChanges(){return function Ey(n,e){return ad(n,e).pipe((0,qs.O)(void 0),Us(),(0,Pe.U)(([t,r])=>r.exists?(null==t?void 0:t.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Pe.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Ir.D)(this.ref.get(e)).pipe(ke.iC)}}class Sy{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Os(this.query,this.afs.schedulers.outsideAngular).pipe((0,Pe.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,za.h)(t=>t.length>0),ke.iC):Os(this.query,this.afs.schedulers.outsideAngular).pipe(ke.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Vs.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=cd(e);return ud(this.query,t,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return qa(this.query,this.afs.schedulers.outsideAngular).pipe((0,Pe.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),ke.iC)}get(e){return(0,Ir.D)(this.query.get(e)).pipe(ke.iC)}}const by=new l.OlP("angularfire2.enableFirestorePersistence"),Ay=new l.OlP("angularfire2.firestore.persistenceSettings"),Cy=new l.OlP("angularfire2.firestore.settings"),Dy=new l.OlP("angularfire2.firestore.use-emulator");function dd(n,e=(t=>t)){return{query:e(n),ref:n}}let Ny=(()=>{class n{constructor(t,r,s,i,o,a,u,c,h,d,f,g,w,S,N,J,pe){this.schedulers=u;const et=(0,xr.on)(t,a,r),Ze=h;d&&(0,gt.nw)(et,a,f,w,S,N,g,J),[this.firestore,this.persistenceEnabled$]=(0,xr.cc)(`${et.name}.firestore`,"AngularFirestore",et.name,()=>{const Ke=a.runOutsideAngular(()=>et.firestore());if(i&&Ke.settings(i),Ze&&Ke.useEmulator(...Ze),s&&!(0,Qa.PM)(o)){const ja=()=>{try{return(0,Ir.D)(Ke.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(Ps){return"undefined"!=typeof console&&console.warn(Ps),(0,$a.of)(!1)}};return[Ke,a.runOutsideAngular(ja)]}return[Ke,(0,$a.of)(!1)]},[i,Ze,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=dd(s,r),a=this.schedulers.ngZone.run(()=>i);return new ld(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new Sy(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new hd(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(l.LFG(xr.Dh),l.LFG(xr.xv,8),l.LFG(by,8),l.LFG(Cy,8),l.LFG(l.Lbi),l.LFG(l.R0b),l.LFG(ke.HU),l.LFG(Ay,8),l.LFG(Dy,8),l.LFG(gt.zQ,8),l.LFG(gt.Qv,8),l.LFG(gt.L6,8),l.LFG(gt._Q,8),l.LFG(gt.rT,8),l.LFG(gt.lh,8),l.LFG(gt.f7,8),l.LFG(_y.nm,8))},n.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Va=(()=>{class n{constructor(t){this.firestore=t}list(){return this.firestore.collection("Employees").snapshotChanges()}get(t){return this.firestore.collection("Employees").doc(t).snapshotChanges()}add(t){return this.firestore.collection("Employees").add(Object.assign({},t))}update(t){return this.firestore.collection("Employees").add(Object.assign({},t))}}return n.\u0275fac=function(t){return new(t||n)(l.LFG(Ny))},n.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac}),n})();var fd=C(1953),md=C(7423),pd=C(5245),gd=C(4841);function ky(n,e){1&n&&(l.TgZ(0,"mat-header-cell"),l._uU(1," ID "),l.qZA())}function Ry(n,e){if(1&n&&(l.TgZ(0,"mat-cell"),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.xp6(1),l.hij(" ",t.id," ")}}function Ly(n,e){1&n&&(l.TgZ(0,"mat-header-cell"),l._uU(1," image "),l.qZA())}function Fy(n,e){if(1&n&&(l.TgZ(0,"mat-cell"),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.xp6(1),l.hij(" ",t.imageSrc," ")}}function My(n,e){1&n&&(l.TgZ(0,"mat-header-cell"),l._uU(1," subject "),l.qZA())}function Oy(n,e){if(1&n&&(l.TgZ(0,"mat-cell"),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.xp6(1),l.hij(" ",t.subject," ")}}function Py(n,e){1&n&&(l.TgZ(0,"mat-header-cell"),l._uU(1," Work Email "),l.qZA())}function qy(n,e){if(1&n&&(l.TgZ(0,"mat-cell"),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.xp6(1),l.hij(" ",t.workEmail," ")}}function Uy(n,e){1&n&&(l.TgZ(0,"mat-header-cell"),l._uU(1," personal Email "),l.qZA())}function Vy(n,e){if(1&n&&(l.TgZ(0,"mat-cell"),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.xp6(1),l.hij(" ",t.personalEmail," ")}}function By(n,e){1&n&&l._UZ(0,"mat-header-row")}function jy(n,e){if(1&n){const t=l.EpF();l.TgZ(0,"mat-row",18),l.NdJ("click",function(){const i=l.CHM(t).$implicit;return l.oxw().onEmployeesDetailNavigate(i)}),l.qZA()}}const Zy=function(){return[5,10,20]};let yd=(()=>{class n{constructor(t,r,s,i){this.employeesService=t,this.loadingBackdropService=r,this.route=s,this.router=i,this.currentIndex=-1,this.dataSource=new Ne.by,this.EmployeesData=[],this.displayedColumns=["id","imageSrc","subject","workEmail","personalEmail"]}ngOnInit(){this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.loadEmployees()}loadEmployees(t){this.employeesService.list().pipe((0,Td.x)(()=>this.loadingBackdropService.hide())).subscribe(r=>{r.forEach(s=>{const i=s.payload.doc.data();i.id=s.payload.doc.id,this.EmployeesData.push(i)}),this.dataSource=new Ne.by(this.EmployeesData),setTimeout(()=>{this.dataSource.paginator=this.paginator},0)})}onEmployeesAddNavigate(){this.router.navigate(["new"],{relativeTo:this.route})}onEmployeesDetailNavigate(t){this.router.navigate([t.id],{relativeTo:this.route})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(Va),l.Y36(fd.C),l.Y36(Bt.gz),l.Y36(Bt.F0))},n.\u0275cmp=l.Xpm({type:n,selectors:[["app-employees-list"]],viewQuery:function(t,r){if(1&t&&(l.Gf(Ga.YE,7),l.Gf(Ka.NW,7)),2&t){let s;l.iGM(s=l.CRH())&&(r.sort=s.first),l.iGM(s=l.CRH())&&(r.paginator=s.first)}},decls:40,vars:5,consts:[[1,"carded"],[1,"top-bg","accent"],[1,"center"],[1,"header","accent"],["type","button","mat-raised-button","",1,"u-margin-l-8"],["type","button","mat-raised-button","",1,"u-margin-l-8",3,"click"],[1,"content-card"],["matSort","",1,"vertical-fit",3,"dataSource"],["matColumnDef","id"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","imageSrc"],["matColumnDef","subject"],["matColumnDef","workEmail"],["matColumnDef","personalEmail"],[4,"matHeaderRowDef"],[3,"click",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],[3,"click"]],template:function(t,r){1&t&&(l.TgZ(0,"div",0),l._UZ(1,"div",1),l.TgZ(2,"div",2),l.TgZ(3,"div",3),l.TgZ(4,"h2"),l._uU(5,"Employees"),l.qZA(),l.TgZ(6,"div"),l.TgZ(7,"button",4),l.TgZ(8,"mat-icon"),l._uU(9,"delete"),l.qZA(),l._uU(10,"DELETE "),l.qZA(),l.TgZ(11,"button",4),l.TgZ(12,"mat-icon"),l._uU(13,"edit"),l.qZA(),l._uU(14,"EDIT "),l.qZA(),l.TgZ(15,"button",5),l.NdJ("click",function(){return r.onEmployeesAddNavigate()}),l.TgZ(16,"mat-icon"),l._uU(17,"add"),l.qZA(),l._uU(18,"ADD "),l.qZA(),l.qZA(),l.qZA(),l.TgZ(19,"div",6),l.TgZ(20,"perfect-scrollbar"),l.TgZ(21,"mat-table",7),l.ynx(22,8),l.YNc(23,ky,2,0,"mat-header-cell",9),l.YNc(24,Ry,2,1,"mat-cell",10),l.BQk(),l.ynx(25,11),l.YNc(26,Ly,2,0,"mat-header-cell",9),l.YNc(27,Fy,2,1,"mat-cell",10),l.BQk(),l.ynx(28,12),l.YNc(29,My,2,0,"mat-header-cell",9),l.YNc(30,Oy,2,1,"mat-cell",10),l.BQk(),l.ynx(31,13),l.YNc(32,Py,2,0,"mat-header-cell",9),l.YNc(33,qy,2,1,"mat-cell",10),l.BQk(),l.ynx(34,14),l.YNc(35,Uy,2,0,"mat-header-cell",9),l.YNc(36,Vy,2,1,"mat-cell",10),l.BQk(),l.YNc(37,By,1,0,"mat-header-row",15),l.YNc(38,jy,1,0,"mat-row",16),l.qZA(),l.qZA(),l._UZ(39,"mat-paginator",17),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(21),l.Q6J("dataSource",r.dataSource),l.xp6(16),l.Q6J("matHeaderRowDef",r.displayedColumns),l.xp6(1),l.Q6J("matRowDefColumns",r.displayedColumns),l.xp6(1),l.Q6J("pageSizeOptions",l.DdM(4,Zy)))},directives:[md.lW,pd.Hw,gd.Vv,Ne.BZ,Ga.YE,Ne.w1,Ne.fO,Ne.ge,Ne.Dz,Ne.ev,Ne.as,Ne.XQ,Ne.nj,Ne.Gk,Ka.NW],styles:["table[_ngcontent-%COMP%]{width:100%}"]}),n})();var Se=C(3075),Ky=C(5177),Gy=C(8966),$y=C(7261),vd=C(3251),wd=C(7322),zy=C(7531);function Qy(n,e){if(1&n){const t=l.EpF();l.TgZ(0,"button",18),l.NdJ("click",function(){return l.CHM(t),l.oxw().addEmployees()}),l.TgZ(1,"span"),l._uU(2,"ADD"),l.qZA(),l.qZA()}if(2&n){const t=l.oxw();l.Q6J("disabled",t.clientForm.invalid)}}function Hy(n,e){if(1&n){const t=l.EpF();l.TgZ(0,"button",18),l.NdJ("click",function(){return l.CHM(t),l.oxw().saveEmployees()}),l.TgZ(1,"span"),l._uU(2,"SAVE"),l.qZA(),l.qZA()}if(2&n){const t=l.oxw();l.Q6J("disabled",t.clientForm.invalid||t.clientForm.pristine)}}function Wy(n,e){if(1&n){const t=l.EpF();l.TgZ(0,"button",19),l.NdJ("click",function(){return l.CHM(t),l.oxw().confirmDeleteEmployees()}),l.TgZ(1,"span"),l._uU(2,"DELETE"),l.qZA(),l.qZA()}}function Yy(n,e){1&n&&(l.TgZ(0,"mat-error",20),l._uU(1," Required field "),l.qZA())}function Jy(n,e){1&n&&(l.TgZ(0,"mat-error",20),l._uU(1," Required field "),l.qZA())}function Xy(n,e){1&n&&(l.TgZ(0,"mat-error",20),l._uU(1," Required field "),l.qZA())}function ev(n,e){1&n&&(l.TgZ(0,"mat-error",20),l._uU(1," Invalid Email "),l.qZA())}function tv(n,e){1&n&&(l.TgZ(0,"mat-error",20),l._uU(1," Required field "),l.qZA())}let Ba=(()=>{class n{constructor(t,r,s,i,o,a){this.dialog=t,this.employeesService=r,this.loadingBackdropService=s,this.snackBar=i,this.route=o,this.router=a,this.initFormBuilder()}ngOnInit(){this.clientId=this.route.snapshot.params.id,this.clientId?(this.pageType="edit",this.employeesService.get(this.clientId).subscribe(t=>{this.loadFormData(t.payload.data())})):this.pageType="new"}navigateToListPage(){this.router.navigate([".."],{relativeTo:this.route})}confirmDeleteEmployees(){this.dialog.open(Ky.$,{data:{title:"Confirm",body:"Are you sure you want to delete this employees?"}}).afterClosed().subscribe(r=>{r&&this.deleteEmployees()})}deleteEmployees(){}saveEmployees(){this.clientForm.getRawValue()}addEmployees(){const t=this.clientForm.getRawValue();this.employeesService.add(t)}initFormBuilder(){this.clientForm=new Se.cw({name:new Se.NI({value:"",disabled:!1},Se.kI.required),documentType:new Se.NI({value:"",disabled:!1}),documentNumber:new Se.NI({value:"",disabled:!1}),email:new Se.NI({value:"",disabled:!1}),address:new Se.NI({value:"",disabled:!1}),phoneNumber:new Se.NI({value:"",disabled:!1})})}loadFormData(t){this.employees=t,this.clientForm.setValue({name:t.personalEmail,documentType:t.personalEmail,documentNumber:t.personalEmail,email:t.personalEmail,address:t.personalEmail,phoneNumber:t.personalEmail})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(Gy.uw),l.Y36(Va),l.Y36(fd.C),l.Y36($y.ux),l.Y36(Bt.gz),l.Y36(Bt.F0))},n.\u0275cmp=l.Xpm({type:n,selectors:[["app-employees-detail"]],decls:39,vars:10,consts:[[1,"carded"],[1,"header","accent"],["mat-icon-button","",3,"click"],["type","button","mat-raised-button","","class","u-margin-l-8",3,"disabled","click",4,"ngIf"],["type","button","mat-raised-button","","class","u-margin-l-8",3,"click",4,"ngIf"],[1,"top-bg","accent"],[1,"content-card"],[1,"vertical-fit",3,"formGroup"],["label","Basic Information"],[1,"u-padding-16"],[2,"width","100%"],["matInput","","placeholder","Name","type","text","formControlName","name"],["class","form-control-feedback",4,"ngIf"],["matInput","","placeholder","Document Type","type","text","formControlName","documentType"],["matInput","","placeholder","Document Number","type","text","formControlName","documentNumber"],["matInput","","placeholder","Email","type","email","formControlName","email"],["matInput","","placeholder","Address","type","text","formControlName","address"],["matInput","","placeholder","Telephone","type","tel","formControlName","phoneNumber"],["type","button","mat-raised-button","",1,"u-margin-l-8",3,"disabled","click"],["type","button","mat-raised-button","",1,"u-margin-l-8",3,"click"],[1,"form-control-feedback"]],template:function(t,r){1&t&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l.TgZ(2,"div"),l.TgZ(3,"button",2),l.NdJ("click",function(){return r.navigateToListPage()}),l.TgZ(4,"mat-icon"),l._uU(5,"arrow_back"),l.qZA(),l.qZA(),l.TgZ(6,"div"),l.TgZ(7,"h2"),l._uU(8),l.qZA(),l.TgZ(9,"p"),l._uU(10,"Employees Detail"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"div"),l.YNc(12,Qy,3,1,"button",3),l.YNc(13,Hy,3,1,"button",3),l.YNc(14,Wy,3,0,"button",4),l.qZA(),l.qZA(),l._UZ(15,"div",5),l.TgZ(16,"perfect-scrollbar",6),l.TgZ(17,"form",7),l.TgZ(18,"fieldset"),l.TgZ(19,"mat-tab-group"),l.TgZ(20,"mat-tab",8),l.TgZ(21,"div",9),l.TgZ(22,"mat-form-field",10),l._UZ(23,"input",11),l.YNc(24,Yy,2,0,"mat-error",12),l.qZA(),l.TgZ(25,"mat-form-field",10),l._UZ(26,"input",13),l.YNc(27,Jy,2,0,"mat-error",12),l.qZA(),l.TgZ(28,"mat-form-field",10),l._UZ(29,"input",14),l.YNc(30,Xy,2,0,"mat-error",12),l.qZA(),l.TgZ(31,"mat-form-field",10),l._UZ(32,"input",15),l.YNc(33,ev,2,0,"mat-error",12),l.qZA(),l.TgZ(34,"mat-form-field",10),l._UZ(35,"input",16),l.YNc(36,tv,2,0,"mat-error",12),l.qZA(),l.TgZ(37,"mat-form-field",10),l._UZ(38,"input",17),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(8),l.Oqu(r.employees?r.employees.id:"Employees"),l.xp6(4),l.Q6J("ngIf","new"===r.pageType),l.xp6(1),l.Q6J("ngIf","edit"===r.pageType),l.xp6(1),l.Q6J("ngIf","edit"===r.pageType),l.xp6(3),l.Q6J("formGroup",r.clientForm),l.xp6(7),l.Q6J("ngIf",!1),l.xp6(3),l.Q6J("ngIf",!1),l.xp6(3),l.Q6J("ngIf",!1),l.xp6(3),l.Q6J("ngIf",!1),l.xp6(3),l.Q6J("ngIf",!1))},directives:[md.lW,pd.Hw,Qa.O5,gd.Vv,Se._Y,Se.JL,Se.sg,vd.SP,vd.uX,wd.KE,zy.Nt,Se.Fj,Se.JJ,Se.u,wd.TO],styles:[""]}),n})();const nv=[{path:"",component:yd},{path:"new",component:Ba},{path:":id",component:Ba}];let rv=(()=>{class n{}return n.components=[yd,Ba],n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({imports:[[Bt.Bz.forChild(nv)],Bt.Bz]}),n})(),sv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({providers:[Va],imports:[[rv,_d.m]]}),n})()}}]);